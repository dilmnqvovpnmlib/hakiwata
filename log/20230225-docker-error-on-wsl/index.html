<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.110.0"><title>Docker Error on WSL2 - haytok's Website</title><meta name=description content="久しぶりに PC を起動してから、WSL2 を起動させて docker コマンドを実行すると、以下のエラーが生じた。
docker: Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?. このエラーメッセージを読むと docker daemon が動いてなさそう。(推測) なので、このエラーメッセージをもとに適当にググると、以下の Docker のコミュニティのフォーラムの記事がヒットした。
WSL - Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running? - General Discussions / General - Docker Community Forums この記事によると、sudo service docker start を実行すると docker daemon が起動して、上述のエラーが発生しなくなるとあった。試してみると、確かにエラーは発生しなくなったが、PC をシャットダウンしてから起動した後に、WSL2 を起動するたびに sudo service docker start を実行するのは面倒臭い。なんか良い方法はないかと調べてみると、/etc/wsl.conf に WLS2 が起動したときに実行できるコマンドを指定できることが下記の記事から明らかになった。
WSL-UbuntuでDockerを起動時に動かす | nryblog WSL での詳細設定の構成 | Microsoft Learn haytok@DESKTOP-SK03JO0:~/hakiwata$ cat /etc/wsl."><link rel="shortcut icon" href=https://haytok.jp/img/images/favicon.ico><link rel=stylesheet href=https://haytok.jp/css/ui.css><link rel=stylesheet href=https://haytok.jp/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Mono|Lato|Raleway"><meta property="og:title" content="Docker Error on WSL2"><meta property="og:description" content="久しぶりに PC を起動してから、WSL2 を起動させて docker コマンドを実行すると、以下のエラーが生じた。
docker: Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?. このエラーメッセージを読むと docker daemon が動いてなさそう。(推測) なので、このエラーメッセージをもとに適当にググると、以下の Docker のコミュニティのフォーラムの記事がヒットした。
WSL - Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running? - General Discussions / General - Docker Community Forums この記事によると、sudo service docker start を実行すると docker daemon が起動して、上述のエラーが発生しなくなるとあった。試してみると、確かにエラーは発生しなくなったが、PC をシャットダウンしてから起動した後に、WSL2 を起動するたびに sudo service docker start を実行するのは面倒臭い。なんか良い方法はないかと調べてみると、/etc/wsl.conf に WLS2 が起動したときに実行できるコマンドを指定できることが下記の記事から明らかになった。
WSL-UbuntuでDockerを起動時に動かす | nryblog WSL での詳細設定の構成 | Microsoft Learn haytok@DESKTOP-SK03JO0:~/hakiwata$ cat /etc/wsl."><meta property="og:type" content="article"><meta property="og:url" content="https://haytok.jp/log/20230225-docker-error-on-wsl/"><meta property="og:image" content="https://haytok.jp/"><meta property="article:section" content="log"><meta property="article:published_time" content="2023-02-25T10:06:16+00:00"><meta property="article:modified_time" content="2023-02-25T10:06:16+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@bilmnpvovqnmlid"><meta name=twitter:creator content="@bilmnpvovqnmlid"><meta property="twitter:image" content="https://haytok.jp/img/images/20230225-docker-error-on-wsl.png"><meta property="og:title" content="Docker Error on WSL2"><meta property="og:url" content="https://haytok.jp/log/20230225-docker-error-on-wsl/"><meta property="og:image" content="https://haytok.jp/img/images/20230225-docker-error-on-wsl.png"><meta property="og:description" content><script async src="https://www.googletagmanager.com/gtag/js?id=G-YXCYPL25QW"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YXCYPL25QW",{anonymize_ip:!1})}</script></head><body><header class="container no-print"><div class=u-header><nav class=bar><ul><li><a href=https://haytok.jp/><img class=icon-text src=https://haytok.jp/img/prev.svg></a></li><li><a href=https://haytok.jp/about>About</a></li><li><a href=https://haytok.jp/log>Log</a></li><li><a href=https://haytok.jp/post>Post</a></li><li><a href=https://haytok.jp/scraps>Scraps</a></li><li><a href=https://haytok.jp/tags>Tags</a></li></ul></nav></div></header><main class=container><article><header><hgroup id=brand><h1>Docker Error on WSL2</h1><h5><time datetime="2023-02-25 10:06:16 +0000 UTC">Feb 25, 2023</time>
<span class=no-print>-
<a href=https://haytok.jp/tags/docker>Docker</a>
<a href=https://haytok.jp/tags/wsl2>WSL2</a>
<a href=https://haytok.jp/tags/linux>Linux</a>
<span></h5></hgroup><hr class=sep></header><p>久しぶりに PC を起動してから、WSL2 を起動させて docker コマンドを実行すると、以下のエラーが生じた。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker: Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?.
</span></span></code></pre></div><p>このエラーメッセージを読むと docker daemon が動いてなさそう。(推測) なので、このエラーメッセージをもとに適当にググると、以下の Docker のコミュニティのフォーラムの記事がヒットした。</p><ul><li><a href=https://forums.docker.com/t/wsl-cannot-connect-to-the-docker-daemon-at-unix-var-run-docker-sock-is-the-docker-daemon-running/116245>WSL - Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running? - General Discussions / General - Docker Community Forums</a></li></ul><p>この記事によると、<code>sudo service docker start</code> を実行すると docker daemon が起動して、上述のエラーが発生しなくなるとあった。試してみると、確かにエラーは発生しなくなったが、PC をシャットダウンしてから起動した後に、WSL2 を起動するたびに <code>sudo service docker start</code> を実行するのは面倒臭い。なんか良い方法はないかと調べてみると、<code>/etc/wsl.conf</code> に WLS2 が起動したときに実行できるコマンドを指定できることが下記の記事から明らかになった。</p><ul><li><a href=https://nryblog.work/wsl-boot-and-start-docker/#WSL%E3%81%AE%E5%BD%B1%E9%9F%BF%E3%81%A7systemd%E3%81%8C%E5%8B%95%E3%81%8B%E3%81%AA%E3%81%84>WSL-UbuntuでDockerを起動時に動かす | nryblog</a></li><li><a href=https://learn.microsoft.com/ja-jp/windows/wsl/wsl-config>WSL での詳細設定の構成 | Microsoft Learn</a></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>haytok@DESKTOP-SK03JO0:~/hakiwata$ cat /etc/wsl.conf
</span></span><span class=line><span class=cl><span class=o>[</span>boot<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nb>command</span> <span class=o>=</span> service docker start<span class=p>;</span>
</span></span></code></pre></div><p>これによって、PC を起動して WSL2 を起動したとしても、特に手動でコマンドを実行することなく docker daemon を実行することができるようになった。</p><hr><p>とういうか、そもそも WSL2 における Docker や systemd</p><p>初期化プロセス / システムには <code>SysVInit</code> と <code>SystemD</code> がある。<code>SystemD</code> は新しめの初期化システムである。</p><ul><li><a href=https://www.baeldung.com/linux/differences-systemctl-service>The Difference Between Systemctl and Service Command in Linux | Baeldung on Linux</a></li></ul><blockquote><p>SysVInit is the classic initialization process in Linux. The initialization process relies on the individual service to install relevant scripts on the /etc/init.d directory. Additionally, the scripts must support the standard commands such as start, stop, and status. One of the main characteristics of this init system is that it is a start-once process and does not track the individual services afterward. The service command is used for running these init scripts from the terminal.</p></blockquote><blockquote><p>SystemD, on the other hand, is a recent initialization system that aims to replace SysVInit. In fact, most Linux distributions such as Debian and Red Hat are already using SystemD as their init system out of the box. In contrast to SysVInit, SystemD continues to run as a daemon process after the initialization is completed. Additionally, they are also actively tracking the services through their cgroups. The systemctl command is the entry point for users to interact and configures the SystemD.</p></blockquote><blockquote><p>In short, the differences between service and systemctl commands can be summarized as two different commands for two different init systems.</p></blockquote><ul><li><a href=https://qiita.com/h_tyokinuhata/items/26b7dd3526e7061596b9>initまとめ(ざっくり) - Qiita</a></li><li><a href=https://www.digitalocean.com/community/tutorials/what-is-systemd>What is systemd? | DigitalOcean</a></li><li><a href=https://systemd.io/>System and Service Manager</a></li></ul><p><code>Ubuntu 20.04 LTS on WSL2</code> では始祖のプロセスは <code>init</code> である。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>haytok@2023-02-26 16:47:44:~/hakiwata <span class=o>(</span>main *%<span class=o>=)</span>
</span></span><span class=line><span class=cl>&gt;&gt;&gt; cat /etc/lsb-release
</span></span><span class=line><span class=cl><span class=nv>DISTRIB_ID</span><span class=o>=</span>Ubuntu
</span></span><span class=line><span class=cl><span class=nv>DISTRIB_RELEASE</span><span class=o>=</span>20.04
</span></span><span class=line><span class=cl><span class=nv>DISTRIB_CODENAME</span><span class=o>=</span>focal
</span></span><span class=line><span class=cl><span class=nv>DISTRIB_DESCRIPTION</span><span class=o>=</span><span class=s2>&#34;Ubuntu 20.04.5 LTS&#34;</span>
</span></span><span class=line><span class=cl>haytok@2023-02-26 16:48:10:~/hakiwata <span class=o>(</span>main *%<span class=o>=)</span>
</span></span><span class=line><span class=cl>&gt;&gt;&gt; ps <span class=m>1</span>
</span></span><span class=line><span class=cl>  PID TTY      STAT   TIME COMMAND
</span></span><span class=line><span class=cl>    <span class=m>1</span> ?        Sl     0:00 /init
</span></span></code></pre></div><p>一方、<code>Amazon Linux 2 on EC2 (AL2)</code> では始祖のプロセスは <code>systemd</code> だった。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>haytok@ip-172-31-3-204 ~<span class=o>]</span>$ cat /etc/os-release
</span></span><span class=line><span class=cl><span class=nv>NAME</span><span class=o>=</span><span class=s2>&#34;Amazon Linux&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>VERSION</span><span class=o>=</span><span class=s2>&#34;2&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>ID</span><span class=o>=</span><span class=s2>&#34;amzn&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>ID_LIKE</span><span class=o>=</span><span class=s2>&#34;centos rhel fedora&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>VERSION_ID</span><span class=o>=</span><span class=s2>&#34;2&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>PRETTY_NAME</span><span class=o>=</span><span class=s2>&#34;Amazon Linux 2&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>ANSI_COLOR</span><span class=o>=</span><span class=s2>&#34;0;33&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CPE_NAME</span><span class=o>=</span><span class=s2>&#34;cpe:2.3:o:amazon:amazon_linux:2&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>HOME_URL</span><span class=o>=</span><span class=s2>&#34;https://amazonlinux.com/&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>haytok@ip-172-31-3-204 ~<span class=o>]</span>$ ps <span class=m>1</span>
</span></span><span class=line><span class=cl>  PID TTY      STAT   TIME COMMAND
</span></span><span class=line><span class=cl>    <span class=m>1</span> ?        Ss     0:07 /usr/lib/systemd/systemd --switched-root --system --deserialize <span class=m>21</span>
</span></span></code></pre></div><p>以上から、比較的新しめの <code>AL2</code> では <code>systemd</code> が使われている一方で、<code>Ubuntu 20.04 LTS on WSL2</code> では <code>init</code> が使用されている。なので、<code>WSL2</code> では docker daemon を起動させるために毎回 <code>/etc/init.d/docker</code> コマンドを実行する必要がある。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>haytok@2023-02-26 16:58:04:~/hakiwata <span class=o>(</span>main *%<span class=o>=)</span>
</span></span><span class=line><span class=cl>&gt;&gt;&gt; ls /etc/init.d <span class=p>|</span> grep docker
</span></span><span class=line><span class=cl>docker
</span></span></code></pre></div><p><code>/etc/init.d</code> 配下にあるスクリプトはデーモンなどの起動スクリプトが設置されている。詳細は下記の情報を参考にすると良い。</p><ul><li><a href=https://linuc.org/study/knowledge/514/>「/etc/init.d」ディレクトリ - Linux技術者認定 LinuC | LPI-Japan</a></li><li><a href=https://qiita.com/manjiroukeigo/items/2b217ffbb50b119d5f58>Linux service関連　基本コマンドメモ - Qiita</a></li></ul><p><code>/etc/init.d/docker</code> の中身は以下である。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/sh
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=nb>set</span> -e
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>... <span class=o>(</span>省略<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span> in
</span></span><span class=line><span class=cl>	start<span class=o>)</span>
</span></span><span class=line><span class=cl>		check_init
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		fail_unless_root
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		cgroupfs_mount
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		touch <span class=s2>&#34;</span><span class=nv>$DOCKER_LOGFILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>		chgrp docker <span class=s2>&#34;</span><span class=nv>$DOCKER_LOGFILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=nb>ulimit</span> -n <span class=m>1048576</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1># Having non-zero limits causes performance problems due to accounting overhead</span>
</span></span><span class=line><span class=cl>		<span class=c1># in the kernel. We recommend using cgroups to do container-local accounting.</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$BASH</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>			<span class=nb>ulimit</span> -u unlimited
</span></span><span class=line><span class=cl>		<span class=k>else</span>
</span></span><span class=line><span class=cl>			<span class=nb>ulimit</span> -p unlimited
</span></span><span class=line><span class=cl>		<span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		log_begin_msg <span class=s2>&#34;Starting </span><span class=nv>$DOCKER_DESC</span><span class=s2>: </span><span class=nv>$BASE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>		start-stop-daemon --start --background <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>			--no-close <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>			--exec <span class=s2>&#34;</span><span class=nv>$DOCKERD</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>			--pidfile <span class=s2>&#34;</span><span class=nv>$DOCKER_SSD_PIDFILE</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>			--make-pidfile <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>			-- <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>				-p <span class=s2>&#34;</span><span class=nv>$DOCKER_PIDFILE</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>				<span class=nv>$DOCKER_OPTS</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>					&gt;&gt; <span class=s2>&#34;</span><span class=nv>$DOCKER_LOGFILE</span><span class=s2>&#34;</span> 2&gt;<span class=p>&amp;</span><span class=m>1</span>
</span></span><span class=line><span class=cl>		log_end_msg <span class=nv>$?</span>
</span></span><span class=line><span class=cl>		<span class=p>;;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>... <span class=o>(</span>省略<span class=o>)</span>
</span></span></code></pre></div><p>この <code>/etc/init.d/docker</code> の中身からもわかるように、<code>/etc/init.d/docker start</code> を実行すると docker daemon がバックグラウンドで起動する。</p><p>ちなみに、下記の記事にもあるように pid 1 が init プロセスの場合、<code>service コマンド</code> を使用して <code>/etc/init.d/</code> 配下のプログラムを実行させることができる。</p><ul><li><a href=https://xtech.nikkei.com/it/article/COLUMN/20070605/273739/>serviceコマンド | 日経クロステック（xTECH）</a></li></ul><blockquote><p>指定されたLinuxデーモン（サービス）の起動や停止，ステータスの確認を実行する。実際はシェル・スクリプトであり，/sbin/serviceをテキスト・エディタなどで開くとスクリプトの中身を確認できる。また，serviceコマンドの中では，/etc/init.d（/etc/rc.d/init.d）にあるサービス・スクリプトを実行しているだけである。そのため，/etc/init.d以下のスクリプトを直接実行してもserviceコマンドと同じ作業ができるが，全サービスのステータスを表示したりパスをいちいち入力する必要がないため，コマンドとして使ったほうが便利である。</p></blockquote><p>これは、<code>service コマンド</code> の中身の <code>A convenient wrapper for the /etc/init.d init scripts.</code> からも確認できる。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>haytok@2023-02-26 17:12:25:~
</span></span><span class=line><span class=cl>&gt;&gt;&gt; which service
</span></span><span class=line><span class=cl>/usr/sbin/service
</span></span><span class=line><span class=cl>haytok@2023-02-26 17:12:32:~
</span></span><span class=line><span class=cl>&gt;&gt;&gt; head -n <span class=m>10</span> /usr/sbin/service
</span></span><span class=line><span class=cl><span class=c1>#!/bin/sh</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>###########################################################################</span>
</span></span><span class=line><span class=cl><span class=c1># /usr/bin/service</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># A convenient wrapper for the /etc/init.d init scripts.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># This script is a modified version of the /sbin/service utility found on</span>
</span></span><span class=line><span class=cl><span class=c1># Red Hat/Fedora systems (licensed GPLv2+).</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span></code></pre></div><p>なので、本環境の <code>WSL2</code> では <code>/etc/wsl.conf</code> に <code>service docker start</code> のコマンドを記述すると、<code>WSL2</code> をシャットダウンして起動したとしても docker daemon が起動した状態になり、前述のエラーが発生しなくなる。</p><hr><p>ちなみに、以下の記事にもあるように PID 1 に <code>systemd</code> を起動させることができるらしい。1 つ目の記事に「<code>「systemd」に依存するLinuxアプリケーションを「WSL」で利用可能になる。</code>」とあるように Docker 自体が <code>systemd</code> に依存したアプリケーションやったから、今回のようなエラーが発生したんかな &mldr;</p><ul><li><a href=https://forest.watch.impress.co.jp/docs/news/1441775.html>「Windows Subsystem for Linux」が「systemd」に対応へ - 窓の杜</a></li><li><a href=https://devblogs.microsoft.com/commandline/systemd-support-is-now-available-in-wsl/>Systemd support is now available in WSL! - Windows Command Line</a></li></ul><p>設定する項目としては以下である。そうすると、<code>WSL2</code> で <code>systemd</code> とやり取りするための <code>systemctl</code> コマンドの実行が可能になる。</p><pre tabindex=0><code class=language-conf data-lang=conf>[boot]
systemd=true
</code></pre><p>なお、当該環境の Windows11 のビルドバージョンは <code>22621.1265</code> である。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>PS C:<span class=se>\U</span>sers<span class=se>\s</span>impl&gt; wsl --version
</span></span><span class=line><span class=cl>WSL バージョン: 1.0.3.0
</span></span><span class=line><span class=cl>カーネル バージョン: 5.15.79.1
</span></span><span class=line><span class=cl>WSLg バージョン: 1.0.47
</span></span><span class=line><span class=cl>MSRDC バージョン: 1.2.3575
</span></span><span class=line><span class=cl>Direct3D バージョン: 1.606.4
</span></span><span class=line><span class=cl>DXCore バージョン: 10.0.25131.1002-220531-1700.rs-onecore-base2-hyp
</span></span><span class=line><span class=cl>Windowsバージョン: 10.0.22621.1265
</span></span></code></pre></div><p><code>systemd</code> を使用するのに必要な要件は、Windows のビルドのバージョンが 22000.0 以上であることなので、動作要件は満たしている。</p><ul><li><a href=https://devblogs.microsoft.com/commandline/a-preview-of-wsl-in-the-microsoft-store-is-now-available/#how-to-install-and-use-wsl-in-the-microsoft-store>A preview of WSL in the Microsoft Store is now available! - Windows Command Line</a></li></ul><blockquote><p>Are using a Windows 11 build or higher (Windows build number 22000 or higher)</p></blockquote><ul><li><a href=https://level69.net/archives/31296>WSL2のUbuntu 22.04でSystemdでDockerを起動させる - 技術的な何か。</a></li><li><a href=https://level69.net/archives/31767>WSLでsystemdのPID=1に対応したらしいので試してみた - 技術的な何か。</a></li></ul><p>メモをまとめていて気づいたが、Ubuntu のディストリビューションで Docker を起動させる場合 (この組み合わせの場合の話)、PID 1 に systemd が起動していることが前提っぽいのが、下記の doc から読み取れる。なので、当該エラーを解消するには PID 1 のプロセスを systemd にするか、service コマンドで docker daemon を起動させるように設定する必要がある。</p><ul><li><a href=https://docs.docker.com/engine/install/linux-postinstall/#configure-docker-to-start-on-boot-with-systemd>Linux post-installation steps for Docker Engine</a></li></ul><blockquote><p>Configure Docker to start on boot with systemd
Many modern Linux distributions use systemd to manage which services start when the system boots. On Debian and Ubuntu, the Docker service starts on boot by default. To automatically start Docker and containerd on boot for other Linux distributions using systemd, run the following commands:</p></blockquote><ul><li><a href=https://docs.docker.jp/engine/articles/systemd.html>systemd と Docker の管理・設定 — Docker-docs-ja 1.9.0b ドキュメント</a></li></ul><blockquote><p>systemd と Docker の管理・設定
多くの Linux ディストリビューションが systemd を使って Docker デーモンを起動します。このドキュメントは、様々な Docker の設定例を紹介します。</p></blockquote><hr><p>ちなみに、<a href=https://github.com/arkane-systems/genie>arkane-systems/genie: A quick way into a systemd &ldquo;bottle&rdquo; for WSL</a> を使用すると、<code>WSL2</code> で pid 1 に <code>systemd</code> を起動させることができるらしい。</p><blockquote><p>Well, this gives you a way to run systemd as pid 1, with all the trimmings, inside WSL 2. It does this by creating a pid namespace, the eponymous poor-man&rsquo;s-container &ldquo;bottle&rdquo;, starting up systemd in there, and entering it, and providing some helpful shortcuts to do so.</p></blockquote><p>WSL2 で systemd を起動させるハックが紹介されていた。</p><ul><li><a href=https://qiita.com/matarillo/items/f036a9561a4839275e5f>WSL2でSystemdを使うハック - Qiita</a></li></ul><h2 id=疑問>疑問</h2><p>systemd と Linux kernel のコードの関連性が全く掴めていないので、今後の課題にしたい。</p><h2 id=参考>参考</h2><ul><li><a href=https://forums.docker.com/t/wsl-cannot-connect-to-the-docker-daemon-at-unix-var-run-docker-sock-is-the-docker-daemon-running/116245>WSL - Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running? - General Discussions / General - Docker Community Forums</a></li><li><a href=https://nryblog.work/wsl-boot-and-start-docker/#WSL%E3%81%AE%E5%BD%B1%E9%9F%BF%E3%81%A7systemd%E3%81%8C%E5%8B%95%E3%81%8B%E3%81%AA%E3%81%84>WSL-UbuntuでDockerを起動時に動かす | nryblog</a></li><li><a href=https://learn.microsoft.com/ja-jp/windows/wsl/wsl-config>WSL での詳細設定の構成 | Microsoft Learn</a></li><li><a href=https://mseeeen.msen.jp/exit-linux-on-windows-terminal/>Windows Terminal で終了コードによらず WSL の終了と同時にウィンドウを閉じる方法 | MSeeeeN</a></li></ul><hr><ul><li><a href=https://access.redhat.com/documentation/ja-jp/red_hat_enterprise_linux/7/html/system_administrators_guide/chap-managing_services_with_systemd#tabl-Managing_Services_with_systemd-Introduction-Units-Types>第10章 systemd によるサービス管理 Red Hat Enterprise Linux 7 | Red Hat Customer Portal</a></li><li><a href=https://blog.ablaze.one/1582/2022-03-09/>systemdとは何をしているものなのか | ABlog</a></li><li><a href=https://log.dot-co.co.jp/systemd-systemctl/>systemdとは？systemctlコマンドとは | .LOG</a></li></ul><hr><ul><li><a href=https://tech.buty4649.net/entry/2022/10/20/162036>Windows10/11のWSL2でDocker Engineを使う - ぶていのログでぶログ</a></li><li><a href=https://snowsystem.net/other/windows/wsl2-ubuntu-systemctl/>Windows 10 or 11 （WSL2）のUbuntuでsystemctlを利用する方法（systemdをPID1で動作させる方法） | Snow System</a></li><li><a href=https://zenn.dev/fehde/articles/103560f2a7065f>WSL2 Ubuntu で PID1 を sytemd にする</a></li></ul></article><nav class="no-print post-nav"><a class=prev-post href=https://haytok.jp/log/20230225-hugo-error/><img class=icon-text src=https://haytok.jp/img/prev.svg>Hugo のバージョンをアップグレードできない事象の解消方法</a>
<a class=next-post href=https://haytok.jp/log/20230225-memory-model-for-linux/>Learning Memory Model for Linux kernel<img class=icon-text src=https://haytok.jp/img/next.svg></a></nav><section id=related><h4>See Also</h4><ul><li><a href=https://haytok.jp/post/20211124/>CyberAgent のコンテナ技術に関する
勉強会に参加してきた</a></li><li><a href=https://haytok.jp/post/20211110/>このブログで使用した技術について</a></li><li><a href=https://haytok.jp/post/20210628/>自作ブログの開発環境を
Docker で移行した</a></li></ul></section><hr class=sep></main><footer class="container no-print"><div class=u-footer><a href=https://github.com/haytok><img class=icon-social src=https://haytok.jp/img/github.svg alt=Github></a>
<a href=https://twitter.com/haytok6><img class=icon-social src=https://haytok.jp/img/twitter.svg alt=Twitter></a>
<a href=https://haytok.jp/index.xml target=_blank><img class=icon-social src=https://haytok.jp/img/feed.svg alt=Feed></a><p>&copy; 2021 haytok</p><a href=#brand><img class=icon-text src=https://haytok.jp/img/toup.svg alt="To Up">
<span>Back to Up</span></a></div></footer></body></html>