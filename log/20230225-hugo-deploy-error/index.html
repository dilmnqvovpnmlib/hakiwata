<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.110.0"><title>Hugo Deploy Error - haytok's Website</title><meta name=description content="deploy.yaml に Hugo バージョン 0.101.1 を修正してすると、GitHub Actions において出力された以下のようなエラーメッセージによりデプロイができなかった。
Setup Hugo Run peaceiris/actions-hugo@v2 with: hugo-version: 0.101.1 extended: false env: pythonLocation: /opt/hostedtoolcache/Python/3.9.16/x64 LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.9.16/x64/lib Hugo version: 0.101.1 Error: Action failed with error Unexpected HTTP response: 404 なぜかわからないが、Hugo バージョン 0.101.1 を指定できないようだった。
下記の公式ページを確認したが、使用できるバージョン一覧等は確認できなかった。Hugo のバージョンは何でもよかったので、サンプルで挙げられていた 0.110.0 を使用するとデプロイエラーは解消された。
with: hugo-version: '0.110.0' Hugo setup · Actions · GitHub Marketplace エラーの原因は不明だが、何となく気になったので、エラーの原因を調査してみた。
エラーメッセージを出力しているのは以下の関数である。
actions-hugo/index.ts at main · peaceiris/actions-hugo core.setFailed(`Action failed with error ${e.message}`); 本来だったらエラーにならず成功するはずの main.run() の処理を追って行く。
メインの処理は以下である。
actions-hugo/main.ts at main · peaceiris/actions-hugo export async function run(): Promise<ActionResult> { const toolVersion: string = core."><link rel="shortcut icon" href=https://haytok.jp/img/images/favicon.ico><link rel=stylesheet href=https://haytok.jp/css/ui.css><link rel=stylesheet href=https://haytok.jp/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Mono|Lato|Raleway"><meta property="og:title" content="Hugo Deploy Error"><meta property="og:description" content="deploy.yaml に Hugo バージョン 0.101.1 を修正してすると、GitHub Actions において出力された以下のようなエラーメッセージによりデプロイができなかった。
Setup Hugo Run peaceiris/actions-hugo@v2 with: hugo-version: 0.101.1 extended: false env: pythonLocation: /opt/hostedtoolcache/Python/3.9.16/x64 LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.9.16/x64/lib Hugo version: 0.101.1 Error: Action failed with error Unexpected HTTP response: 404 なぜかわからないが、Hugo バージョン 0.101.1 を指定できないようだった。
下記の公式ページを確認したが、使用できるバージョン一覧等は確認できなかった。Hugo のバージョンは何でもよかったので、サンプルで挙げられていた 0.110.0 を使用するとデプロイエラーは解消された。
with: hugo-version: '0.110.0' Hugo setup · Actions · GitHub Marketplace エラーの原因は不明だが、何となく気になったので、エラーの原因を調査してみた。
エラーメッセージを出力しているのは以下の関数である。
actions-hugo/index.ts at main · peaceiris/actions-hugo core.setFailed(`Action failed with error ${e.message}`); 本来だったらエラーにならず成功するはずの main.run() の処理を追って行く。
メインの処理は以下である。
actions-hugo/main.ts at main · peaceiris/actions-hugo export async function run(): Promise<ActionResult> { const toolVersion: string = core."><meta property="og:type" content="article"><meta property="og:url" content="https://haytok.jp/log/20230225-hugo-deploy-error/"><meta property="og:image" content="https://haytok.jp/"><meta property="article:section" content="log"><meta property="article:published_time" content="2023-02-25T18:15:42+00:00"><meta property="article:modified_time" content="2023-02-25T18:15:42+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@bilmnpvovqnmlid"><meta name=twitter:creator content="@bilmnpvovqnmlid"><meta property="twitter:image" content="https://haytok.jp/img/images/20230225-hugo-deploy-error.png"><meta property="og:title" content="Hugo Deploy Error"><meta property="og:url" content="https://haytok.jp/log/20230225-hugo-deploy-error/"><meta property="og:image" content="https://haytok.jp/img/images/20230225-hugo-deploy-error.png"><meta property="og:description" content><script async src="https://www.googletagmanager.com/gtag/js?id=G-YXCYPL25QW"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YXCYPL25QW",{anonymize_ip:!1})}</script></head><body><header class="container no-print"><div class=u-header><nav class=bar><ul><li><a href=https://haytok.jp/><img class=icon-text src=https://haytok.jp/img/prev.svg></a></li><li><a href=https://haytok.jp/about>About</a></li><li><a href=https://haytok.jp/log>Log</a></li><li><a href=https://haytok.jp/post>Post</a></li><li><a href=https://haytok.jp/scraps>Scraps</a></li><li><a href=https://haytok.jp/tags>Tags</a></li></ul></nav></div></header><main class=container><article><header><hgroup id=brand><h1>Hugo Deploy Error</h1><h5><time datetime="2023-02-25 18:15:42 +0000 UTC">Feb 25, 2023</time>
<span class=no-print>-
<a href=https://haytok.jp/tags/hugo>Hugo</a>
<span></h5></hgroup><hr class=sep></header><p><code>deploy.yaml</code> に Hugo バージョン <code>0.101.1</code> を修正してすると、GitHub Actions において出力された以下のようなエラーメッセージによりデプロイができなかった。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Setup Hugo
</span></span><span class=line><span class=cl>Run peaceiris/actions-hugo@v2
</span></span><span class=line><span class=cl>  with:
</span></span><span class=line><span class=cl>    hugo-version: 0.101.1
</span></span><span class=line><span class=cl>    extended: <span class=nb>false</span>
</span></span><span class=line><span class=cl>  env:
</span></span><span class=line><span class=cl>    pythonLocation: /opt/hostedtoolcache/Python/3.9.16/x64
</span></span><span class=line><span class=cl>    LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.9.16/x64/lib
</span></span><span class=line><span class=cl>Hugo version: 0.101.1
</span></span><span class=line><span class=cl>Error: Action failed with error Unexpected HTTP response: <span class=m>404</span>
</span></span></code></pre></div><p>なぜかわからないが、Hugo バージョン <code>0.101.1</code> を指定できないようだった。</p><p>下記の公式ページを確認したが、使用できるバージョン一覧等は確認できなかった。Hugo のバージョンは何でもよかったので、サンプルで挙げられていた <code>0.110.0</code> を使用するとデプロイエラーは解消された。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>hugo-version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;0.110.0&#39;</span><span class=w>
</span></span></span></code></pre></div><ul><li><a href=https://github.com/marketplace/actions/hugo-setup>Hugo setup · Actions · GitHub Marketplace</a></li></ul><p>エラーの原因は不明だが、何となく気になったので、エラーの原因を調査してみた。</p><p>エラーメッセージを出力しているのは以下の関数である。</p><ul><li><a href=https://github.com/peaceiris/actions-hugo/blob/main/src/index.ts#L8>actions-hugo/index.ts at main · peaceiris/actions-hugo</a></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl>    <span class=nx>core</span><span class=p>.</span><span class=nx>setFailed</span><span class=p>(</span><span class=sb>`Action failed with error </span><span class=si>${</span><span class=nx>e</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span></code></pre></div><p>本来だったらエラーにならず成功するはずの <code>main.run()</code> の処理を追って行く。</p><p>メインの処理は以下である。</p><ul><li><a href=https://github.com/peaceiris/actions-hugo/blob/main/src/main.ts#L49>actions-hugo/main.ts at main · peaceiris/actions-hugo</a></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>export</span> <span class=kr>async</span> <span class=kd>function</span> <span class=nx>run</span><span class=p>()</span><span class=o>:</span> <span class=nb>Promise</span><span class=o>&lt;</span><span class=nx>ActionResult</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>toolVersion</span><span class=o>:</span> <span class=nx>string</span> <span class=o>=</span> <span class=nx>core</span><span class=p>.</span><span class=nx>getInput</span><span class=p>(</span><span class=s1>&#39;hugo-version&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>...</span> <span class=p>(</span><span class=nx>省略</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>toolVersion</span> <span class=o>===</span> <span class=s1>&#39;&#39;</span> <span class=o>||</span> <span class=nx>toolVersion</span> <span class=o>===</span> <span class=s1>&#39;latest&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>installVersion</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>getLatestVersion</span><span class=p>(</span><span class=nx>Tool</span><span class=p>.</span><span class=nx>Org</span><span class=p>,</span> <span class=nx>Tool</span><span class=p>.</span><span class=nx>Repo</span><span class=p>,</span> <span class=s1>&#39;brew&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>installVersion</span> <span class=o>=</span> <span class=nx>toolVersion</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>...</span> <span class=p>(</span><span class=nx>省略</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>installer</span><span class=p>(</span><span class=nx>installVersion</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>...</span> <span class=p>(</span><span class=nx>省略</span><span class=p>)</span>
</span></span></code></pre></div><p><code>yaml</code> に <code>hugo-version</code> を指定するとそのバージョンが変数 <code>toolVersion</code> に格納される。そのバージョンをもとに関数 <code>installer()</code> が呼び出される。実装の詳細は以下である。</p><ul><li><a href=https://github.com/peaceiris/actions-hugo/blob/main/src/installer.ts#L46>actions-hugo/installer.ts at main · peaceiris/actions-hugo</a></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>export</span> <span class=kr>async</span> <span class=kd>function</span> <span class=nx>installer</span><span class=p>(</span><span class=nx>version</span><span class=o>:</span> <span class=nx>string</span><span class=p>)</span><span class=o>:</span> <span class=nb>Promise</span><span class=o>&lt;</span><span class=k>void</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>...</span> <span class=p>(</span><span class=nx>省略</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>toolURL</span><span class=o>:</span> <span class=nx>string</span> <span class=o>=</span> <span class=nx>getURL</span><span class=p>(</span><span class=nx>osName</span><span class=p>,</span> <span class=nx>archName</span><span class=p>,</span> <span class=nx>extended</span><span class=p>,</span> <span class=nx>version</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>core</span><span class=p>.</span><span class=nx>debug</span><span class=p>(</span><span class=sb>`toolURL: </span><span class=si>${</span><span class=nx>toolURL</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>...</span> <span class=p>(</span><span class=nx>省略</span><span class=p>)</span>
</span></span></code></pre></div><p><code>hugo-version</code> を使用して Hugo のバイナリを取得する関数が <code>getURL()</code> なので、その詳細を確認する。</p><ul><li><a href=https://github.com/peaceiris/actions-hugo/blob/main/src/get-url.ts#L27>actions-hugo/get-url.ts at main · peaceiris/actions-hugo</a></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=p>...</span> <span class=p>(</span><span class=nx>省略</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>hugoName</span> <span class=o>=</span> <span class=sb>`hugo_</span><span class=si>${</span><span class=nx>extendedStr</span><span class=p>(</span><span class=nx>extended</span><span class=p>)</span><span class=si>}${</span><span class=nx>version</span><span class=si>}</span><span class=sb>_</span><span class=si>${</span><span class=nx>os</span><span class=si>}</span><span class=sb>-</span><span class=si>${</span><span class=nx>arch</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>baseURL</span> <span class=o>=</span> <span class=s1>&#39;https://github.com/gohugoio/hugo/releases/download&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>url</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nx>baseURL</span><span class=si>}</span><span class=sb>/v</span><span class=si>${</span><span class=nx>version</span><span class=si>}</span><span class=sb>/</span><span class=si>${</span><span class=nx>hugoName</span><span class=si>}</span><span class=sb>.</span><span class=si>${</span><span class=nx>ext</span><span class=p>(</span><span class=nx>os</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>...</span> <span class=p>(</span><span class=nx>省略</span><span class=p>)</span>
</span></span></code></pre></div><p>あー、これ、単純に Hugo のバイナリを配布しているリリースノートのリンクを生成してるだけっぽい。配布されているバージョンを以下のリンクから確認すると、配布されているバージョンに <code>0.101.1</code> はそもそもないため、<code>404</code> のエラーが返っていた。</p><ul><li><a href="https://github.com/gohugoio/hugo/tags?after=v0.103.0">Tags · gohugoio/hugo</a></li></ul><p>以上から、<code>hugo-version</code> で指定できるバージョンは Hugo のリリースノートに記載されているバージョンを適切に指定しないといけない。</p></article><nav class="no-print post-nav"><a class=prev-post href=https://haytok.jp/log/20230225-bash-prompt/><img class=icon-text src=https://haytok.jp/img/prev.svg>bash の表示の微修正</a></nav><section id=related><h4>See Also</h4><ul><li><a href=https://haytok.jp/log/20230225-hugo-error/>Hugo のバージョンをアップグレードできない事象の解消方法</a></li><li><a href=https://haytok.jp/post/20211110/>このブログで使用した技術について</a></li><li><a href=https://haytok.jp/post/20210628/>自作ブログの開発環境を
Docker で移行した</a></li></ul></section><hr class=sep></main><footer class="container no-print"><div class=u-footer><a href=https://github.com/haytok><img class=icon-social src=https://haytok.jp/img/github.svg alt=Github></a>
<a href=https://twitter.com/haytok6><img class=icon-social src=https://haytok.jp/img/twitter.svg alt=Twitter></a>
<a href=https://haytok.jp/index.xml target=_blank><img class=icon-social src=https://haytok.jp/img/feed.svg alt=Feed></a><p>&copy; 2021 haytok</p><a href=#brand><img class=icon-text src=https://haytok.jp/img/toup.svg alt="To Up">
<span>Back to Up</span></a></div></footer></body></html>