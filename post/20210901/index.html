<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.83.1"><title>自作 OS 日記 (3) - haKiwata</title><meta name=description content="概要  こんにちは！前回に引き続き自作 OS 日記を付けたいと思います。このエントリでは 21 ~ 30 章までの記録を残したいと思います。  日記 2021 年 9 月 25 日 osbook_day21a  IST を設定しました！  osbook_day21b  rpn コマンド で引き算した結果をターミナルに出力するためのシステムコールを実装した。だいぶ身近な箇所の実装にまで辿り着いてさらに楽しくなってきた。  2021 年 9 月 26 日 osbook_day21c  終了のシステムコールを実装しました！この実装により、rpn コマンドで足し算や引き算をした結果を出力し、制御をターミナルに戻すことができます。    今回は、解説されているプログラムをアプリケーション側から写経していきました。つまり、apps/rpn/rpn.cpp の main 関数 内で SyscallExit を呼び出すことから実装を始めました。これは、前節ではアセンブリから実装を始めたので、視点を変えたかったためです。
  この節を実装して特に感じたことがあります。それは、節によっては説明が前後するため、紹介されているプログラムを読んで直後の解説を読んでもわけがわからないときが多々あることです。自分は紹介されているプログラムが自分で理解できる時は、プログラムを読んで自分なりの解釈を作ってから直後に書かれている解説を読むようにしています。しかし、プログラムを読んでなぜこの実装にしたのかの意図が全くわからず、直後の解説を読んでも特に触れられていない時があります。その時は、その実装の解釈に対してめちゃくちゃ悩み、妥協して読み進めるしかありません。そして、読み進めると、後の方のページでそのプログラムに対する解説を見つけると、何やねんと思ったりすることもありました。紙面や解説の都合上こうなるのはしょうがないと思うのですが、おいってなります。そのため、自分のこの本の読み方を改めつつ、もっと多くの知識を付けたいと思いました。
  2021 年 9 月 27 日 osbook_day21d  アプリケーションが増えてきたので、アプリケーションのリファクタリングを行いました。UI に特に変更はありません。  osbook_day21e  ウィンドウを開くシステムコールを実装しました。  osbook_day21f  前節で実装したシステムコールに機能を加え、開いたウィンドウに文字を表示させました。   2021 年 9 月 28 日 osbook_day22a  exit システムコール を実装しました。これまで SyscallExit と記述していた実装を exit に書き換えて C の標準ライブラリを使うように修正しました。しかし、以下のように _exit が定義されていないというエラ−が出ます。そこで、エラーログに書かれているように apps/newlib_support."><link rel="shortcut icon" href=https://hakiwata.jp/img/images/kiwata.png><link rel=stylesheet href=https://hakiwata.jp/css/ui.css><link rel=stylesheet href=https://hakiwata.jp/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Mono|Lato|Raleway"><meta property="og:title" content="自作 OS 日記 (3)"><meta property="og:description" content="概要  こんにちは！前回に引き続き自作 OS 日記を付けたいと思います。このエントリでは 21 ~ 30 章までの記録を残したいと思います。  日記 2021 年 9 月 25 日 osbook_day21a  IST を設定しました！  osbook_day21b  rpn コマンド で引き算した結果をターミナルに出力するためのシステムコールを実装した。だいぶ身近な箇所の実装にまで辿り着いてさらに楽しくなってきた。  2021 年 9 月 26 日 osbook_day21c  終了のシステムコールを実装しました！この実装により、rpn コマンドで足し算や引き算をした結果を出力し、制御をターミナルに戻すことができます。    今回は、解説されているプログラムをアプリケーション側から写経していきました。つまり、apps/rpn/rpn.cpp の main 関数 内で SyscallExit を呼び出すことから実装を始めました。これは、前節ではアセンブリから実装を始めたので、視点を変えたかったためです。
  この節を実装して特に感じたことがあります。それは、節によっては説明が前後するため、紹介されているプログラムを読んで直後の解説を読んでもわけがわからないときが多々あることです。自分は紹介されているプログラムが自分で理解できる時は、プログラムを読んで自分なりの解釈を作ってから直後に書かれている解説を読むようにしています。しかし、プログラムを読んでなぜこの実装にしたのかの意図が全くわからず、直後の解説を読んでも特に触れられていない時があります。その時は、その実装の解釈に対してめちゃくちゃ悩み、妥協して読み進めるしかありません。そして、読み進めると、後の方のページでそのプログラムに対する解説を見つけると、何やねんと思ったりすることもありました。紙面や解説の都合上こうなるのはしょうがないと思うのですが、おいってなります。そのため、自分のこの本の読み方を改めつつ、もっと多くの知識を付けたいと思いました。
  2021 年 9 月 27 日 osbook_day21d  アプリケーションが増えてきたので、アプリケーションのリファクタリングを行いました。UI に特に変更はありません。  osbook_day21e  ウィンドウを開くシステムコールを実装しました。  osbook_day21f  前節で実装したシステムコールに機能を加え、開いたウィンドウに文字を表示させました。   2021 年 9 月 28 日 osbook_day22a  exit システムコール を実装しました。これまで SyscallExit と記述していた実装を exit に書き換えて C の標準ライブラリを使うように修正しました。しかし、以下のように _exit が定義されていないというエラ−が出ます。そこで、エラーログに書かれているように apps/newlib_support."><meta property="og:type" content="article"><meta property="og:url" content="https://hakiwata.jp/post/20210901/"><meta property="og:image" content="https://hakiwata.jp/img/images/kiwata.png"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-09-01T19:11:00+00:00"><meta property="article:modified_time" content="2021-09-01T19:11:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://hakiwata.jp/img/images/kiwata.png"><meta name=twitter:title content="自作 OS 日記 (3)"><meta name=twitter:description content="概要  こんにちは！前回に引き続き自作 OS 日記を付けたいと思います。このエントリでは 21 ~ 30 章までの記録を残したいと思います。  日記 2021 年 9 月 25 日 osbook_day21a  IST を設定しました！  osbook_day21b  rpn コマンド で引き算した結果をターミナルに出力するためのシステムコールを実装した。だいぶ身近な箇所の実装にまで辿り着いてさらに楽しくなってきた。  2021 年 9 月 26 日 osbook_day21c  終了のシステムコールを実装しました！この実装により、rpn コマンドで足し算や引き算をした結果を出力し、制御をターミナルに戻すことができます。    今回は、解説されているプログラムをアプリケーション側から写経していきました。つまり、apps/rpn/rpn.cpp の main 関数 内で SyscallExit を呼び出すことから実装を始めました。これは、前節ではアセンブリから実装を始めたので、視点を変えたかったためです。
  この節を実装して特に感じたことがあります。それは、節によっては説明が前後するため、紹介されているプログラムを読んで直後の解説を読んでもわけがわからないときが多々あることです。自分は紹介されているプログラムが自分で理解できる時は、プログラムを読んで自分なりの解釈を作ってから直後に書かれている解説を読むようにしています。しかし、プログラムを読んでなぜこの実装にしたのかの意図が全くわからず、直後の解説を読んでも特に触れられていない時があります。その時は、その実装の解釈に対してめちゃくちゃ悩み、妥協して読み進めるしかありません。そして、読み進めると、後の方のページでそのプログラムに対する解説を見つけると、何やねんと思ったりすることもありました。紙面や解説の都合上こうなるのはしょうがないと思うのですが、おいってなります。そのため、自分のこの本の読み方を改めつつ、もっと多くの知識を付けたいと思いました。
  2021 年 9 月 27 日 osbook_day21d  アプリケーションが増えてきたので、アプリケーションのリファクタリングを行いました。UI に特に変更はありません。  osbook_day21e  ウィンドウを開くシステムコールを実装しました。  osbook_day21f  前節で実装したシステムコールに機能を加え、開いたウィンドウに文字を表示させました。   2021 年 9 月 28 日 osbook_day22a  exit システムコール を実装しました。これまで SyscallExit と記述していた実装を exit に書き換えて C の標準ライブラリを使うように修正しました。しかし、以下のように _exit が定義されていないというエラ−が出ます。そこで、エラーログに書かれているように apps/newlib_support."><script async src="https://www.googletagmanager.com/gtag/js?id=G-YXCYPL25QW"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-YXCYPL25QW',{anonymize_ip:!1})}</script></head><body><header class="container no-print"><div class=u-header><nav class=bar><ul><li><a href=https://hakiwata.jp/><img class=icon-text src=https://hakiwata.jp/img/prev.svg></a></li><li><a href=https://hakiwata.jp/about>About</a></li><li><a href=https://hakiwata.jp/post>Post</a></li><li><a href=https://hakiwata.jp/scraps>Scraps</a></li><li><a href=https://hakiwata.jp/tags>Tags</a></li></ul></nav></div></header><main class=container><article><header><hgroup id=brand><h1>自作 OS 日記 (3)</h1><h5><time datetime="2021-09-01 19:11:00 +0000 UTC">Sep 01, 2021</time>
<span class=no-print>-
<a href=https://hakiwata.jp/tags/os>OS</a>
<a href=https://hakiwata.jp/tags/kernel>Kernel</a>
<a href=https://hakiwata.jp/tags/c>C</a>
<span></h5></hgroup><hr class=sep></header><h2 id=概要>概要</h2><ul><li>こんにちは！前回に引き続き自作 OS 日記を付けたいと思います。このエントリでは 21 ~ 30 章までの記録を残したいと思います。</li></ul><h2 id=日記>日記</h2><h3 id=2021-年-9-月-25-日>2021 年 9 月 25 日</h3><h4 id=osbook_day21a>osbook_day21a</h4><ul><li>IST を設定しました！</li></ul><p><img src=media/osbook_day21a.gif alt=osbook_day21a.gif></p><h4 id=osbook_day21b>osbook_day21b</h4><ul><li><code>rpn コマンド</code> で引き算した結果をターミナルに出力するためのシステムコールを実装した。だいぶ身近な箇所の実装にまで辿り着いてさらに楽しくなってきた。</li></ul><p><img src=media/osbook_day21b.gif alt=osbook_day21b.gif></p><h3 id=2021-年-9-月-26-日>2021 年 9 月 26 日</h3><h4 id=osbook_day21c>osbook_day21c</h4><ul><li>終了のシステムコールを実装しました！この実装により、<code>rpn</code> コマンドで足し算や引き算をした結果を出力し、制御をターミナルに戻すことができます。</li></ul><p><img src=media/osbook_day21c.gif alt=osbook_day21c.gif></p><ul><li><p>今回は、解説されているプログラムをアプリケーション側から写経していきました。つまり、<code>apps/rpn/rpn.cpp</code> の <code>main 関数</code> 内で <code>SyscallExit</code> を呼び出すことから実装を始めました。これは、前節ではアセンブリから実装を始めたので、視点を変えたかったためです。</p></li><li><p>この節を実装して特に感じたことがあります。それは、節によっては説明が前後するため、紹介されているプログラムを読んで直後の解説を読んでもわけがわからないときが多々あることです。自分は紹介されているプログラムが自分で理解できる時は、プログラムを読んで自分なりの解釈を作ってから直後に書かれている解説を読むようにしています。しかし、プログラムを読んでなぜこの実装にしたのかの意図が全くわからず、直後の解説を読んでも特に触れられていない時があります。その時は、その実装の解釈に対してめちゃくちゃ悩み、妥協して読み進めるしかありません。そして、読み進めると、後の方のページでそのプログラムに対する解説を見つけると、何やねんと思ったりすることもありました。紙面や解説の都合上こうなるのはしょうがないと思うのですが、おいってなります。そのため、自分のこの本の読み方を改めつつ、もっと多くの知識を付けたいと思いました。</p></li></ul><h3 id=2021-年-9-月-27-日>2021 年 9 月 27 日</h3><h4 id=osbook_day21d>osbook_day21d</h4><ul><li>アプリケーションが増えてきたので、アプリケーションのリファクタリングを行いました。UI に特に変更はありません。</li></ul><p><img src=media/osbook_day21d.gif alt=osbook_day21d.gif></p><h4 id=osbook_day21e>osbook_day21e</h4><ul><li>ウィンドウを開くシステムコールを実装しました。</li></ul><p><img src=media/osbook_day21e.gif alt=osbook_day21e.gif></p><h4 id=hahahugoshortcode-s2-hbhb>osbook_day21f</h4><ul><li>前節で実装したシステムコールに機能を加え、開いたウィンドウに文字を表示させました。</li></ul><p><img src=media/osbook_day21f.gif alt=osbook_day21f.gif></p><h3 id=2021-年-9-月-28-日>2021 年 9 月 28 日</h3><h4 id=hahahugoshortcode-s5-hbhb>osbook_day22a</h4><ul><li><code>exit システムコール</code> を実装しました。これまで <code>SyscallExit</code> と記述していた実装を <code>exit</code> に書き換えて C の標準ライブラリを使うように修正しました。しかし、以下のように <code>_exit</code> が定義されていないというエラ−が出ます。そこで、エラーログに書かれているように <code>apps/newlib_support.c</code> に <code>_exit</code> を定義し、諸々の修正を行いました。その結果、最終的にはライブラリ関数の <code>exit</code> を呼び出すことでアプリケーションを終了させることができました。</li></ul><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>clang++     -I/home/h-kiwata/osbook/devenv/x86_64-elf/include/c++/v1 -I/home/h-kiwata/osbook/devenv/x86_64-elf/include -I/home/h-kiwata/osbook/devenv/x86_64-elf/include/freetype2     -I/home/h-kiwata/edk2/MdePkg/Include -I/home/h-kiwata/edk2/MdePkg/Include/X64     -nostdlibinc -D__ELF__ -D_LDBL_EQ_DBL -D_GNU_SOURCE -D_POSIX_TIMERS     -DEFIAPI<span class=o>=</span><span class=s1>&#39;__attribute__((ms_abi))&#39;</span> -I. -O2 -Wall -g --target<span class=o>=</span>x86_64-elf -ffreestanding -mcmodel<span class=o>=</span>large -fno-exceptions -fno-rtti -std<span class=o>=</span>c++17 -c rpn.cpp -o rpn.o
ld.lld -L/home/h-kiwata/osbook/devenv/x86_64-elf/lib --entry main -z norelro --image-base 0xffff800000000000 --static -o rpn rpn.o ../syscall.o ../newlib_support.o -lc -lc++ -lc++abi
ld.lld: error: undefined symbol: _exit
&gt;&gt;&gt; referenced by exit.c
&gt;&gt;&gt;               lib_a-exit.o:<span class=o>(</span><span class=nb>exit</span><span class=o>)</span> in archive /home/h-kiwata/osbook/devenv/x86_64-elf/lib/libc.a
../Makefile.elfapp:12: recipe <span class=k>for</span> target <span class=s1>&#39;rpn&#39;</span> failed
make<span class=o>[</span>1<span class=o>]</span>: *** <span class=o>[</span>rpn<span class=o>]</span> Error <span class=m>1</span>
make<span class=o>[</span>1<span class=o>]</span>: ディレクトリ <span class=s1>&#39;/home/h-kiwata/honOS/apps/rpn&#39;</span> から出ます
Makefile:3: recipe <span class=k>for</span> target <span class=s1>&#39;build&#39;</span> failed
make: *** <span class=o>[</span>build<span class=o>]</span> Error <span class=m>2</span>
</code></pre></div><p><img src=media/osbook_day22a.gif alt=osbook_day22a.gif></p><h4 id=hahahugoshortcode-s8-hbhb>osbook_day22b</h4><ul><li>星が描画されたウィンドウを出すアプリケーションを実装しました。</li></ul><p><img src=media/osbook_day22b.gif alt=osbook_day22b.gif></p><h4 id=hahahugoshortcode-s11-hbhb>osbook_day22c</h4><ul><li>タイマカウントを取得するためのシステムコールを追加しました。。</li></ul><p><img src=media/osbook_day22c.gif alt=osbook_day22c.gif></p><h4 id=hahahugoshortcode-s14-hbhb>osbook_day22d</h4><ul><li>画面の描画の最適化を行いました。gif からもわかるように前節と比較して描画時間が高速になりました。</li></ul><p><img src=media/osbook_day22d.gif alt=osbook_day22d.gif></p><h3 id=2021-年-9-月-29-日>2021 年 9 月 29 日</h3><h4 id=hahahugoshortcode-s17-hbhb>osbook_day22e</h4><ul><li><code>lines</code> アプリケーションを実装しました。点をブロットして線を表現しているのですが、 gif の上の方は、傾きが大きくなるほど点の間隔が広くなり上手く描画できていません。それに改善を加えたのが下の方の gif です。下の gif では傾きが急になっても点と点の間隔が広くないような工夫を施しています。</li></ul><p><img src=media/osbook_day22e-invalid.gif alt=osbook_day22e-invalid.gif></p><p><img src=media/osbook_day22e.gif alt=osbook_day22e.gif></p><h4 id=hahahugoshortcode-s23-hbhb>osbook_day22f</h4><ul><li>アプリケーションのウィンドウを閉じるロジックを追加しました。現時点ではアプリケーションを開くとすぐに終了してしまいます。次節でコマンドでアプリケーションを終了できるように修正します。</li></ul><p><img src=media/osbook_day22f.gif alt=osbook_day22f.gif></p><h4 id=hahahugoshortcode-s26-hbhb>osbook_day22g</h4><ul><li><code>Ctrl + Q</code> でアプリケーションを閉じる機能を追加しました。これでアプリケーションを閉じることができます！</li></ul><p><img src=media/osbook_day22g.gif alt=osbook_day22g.gif></p><h3 id=2021-年-9-月-30-日>2021 年 9 月 30 日</h3><h4 id=hahahugoshortcode-s29-hbhb>osbook_day23a</h4><ul><li>Ubuntu の <code>xeyes</code> のようなアプリケーションを実装しました。アプリケーションを起動しアクティブな状態だと、マウスが移動する方向にアプリケーションのウィンドウ内の点が移動します。</li></ul><p><img src=media/osbook_day23a.gif alt=osbook_day23a.gif></p><h4 id=hahahugoshortcode-s32-hbhb>osbook_day23b</h4><ul><li>マウスの左ボタンをクリックしながらペイントウィンドウ内でカーソルを移動させると、文字を書くことができる機能を実装しました。</li></ul><p><img src=media/osbook_day23b.gif alt=osbook_day23b.gif></p><h3 id=2021-年-10-月-1-日>2021 年 10 月 1 日</h3><h4 id=hahahugoshortcode-s35-hbhb>osbook_day23c</h4><ul><li>一定時間スリープするコマンド <code>timer</code> コマンドを実装しました。</li></ul><p><img src=media/osbook_day23c.gif alt=osbook_day23c.gif></p><h4 id=hahahugoshortcode-s38-hbhb>osbook_day23d</h4><ul><li><code>cube</code> コマンドを実装しました。</li></ul><p><img src=media/osbook_day23d.gif alt=osbook_day23d.gif></p><h4 id=hahahugoshortcode-s41-hbhb>osbook_day23e</h4><ul><li><p>この節では、ブロック崩しコマンド <code>blocks</code> を実装しました。</p></li><li><p>このコマンドを実装する際に、 <code>newlib_support.c</code> に不足するライブラリ関数を追加する必要があります。それらの関数は、Kernel をビルドする際に現れる以下のエラーから確認できます。それらは、<code>getpid</code> と <code>kill</code> です。</p></li></ul><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>ld.lld -L/home/h-kiwata/osbook/devenv/x86_64-elf/lib --entry main -z norelro --image-base 0xffff800000000000 --static -o blocks blocks.o ../syscall.o ../newlib_support.o -lc -lc++ -lc++abi -lm
ld.lld: error: undefined symbol: <span class=nb>kill</span>
&gt;&gt;&gt; referenced by signalr.c
&gt;&gt;&gt;               lib_a-signalr.o:<span class=o>(</span>_kill_r<span class=o>)</span> in archive /home/h-kiwata/osbook/devenv/x86_64-elf/lib/libc.a

ld.lld: error: undefined symbol: getpid
&gt;&gt;&gt; referenced by signalr.c
&gt;&gt;&gt;               lib_a-signalr.o:<span class=o>(</span>_getpid_r<span class=o>)</span> in archive /home/h-kiwata/osbook/devenv/x86_64-elf/lib/libc.a
../Makefile.elfapp:12: recipe <span class=k>for</span> target <span class=s1>&#39;blocks&#39;</span> failed
make<span class=o>[</span>1<span class=o>]</span>: *** <span class=o>[</span>blocks<span class=o>]</span> Error <span class=m>1</span>
make<span class=o>[</span>1<span class=o>]</span>: ディレクトリ <span class=s1>&#39;/home/h-kiwata/honOS/apps/blocks&#39;</span> から出ます
Makefile:3: recipe <span class=k>for</span> target <span class=s1>&#39;build&#39;</span> failed
make: *** <span class=o>[</span>build<span class=o>]</span> Error <span class=m>2</span>
</code></pre></div><ul><li>きちんと条件分岐のロジックを設定しないと、文字列がダブって入力されてします。</li></ul><p><p><img src=media/osbook_day23e-invalid.gif alt=osbook_day23e-invalid.gif></p></p><ul><li>以下の画像からもわかるようにブロック崩しゲームを実装できました。</li></ul><p><p><img src=media/osbook_day23e.gif alt=osbook_day23e.gif></p></p><h4 id=hahahugoshortcode-s47-hbhb>osbook_day24a</h4><ul><li><code>F2</code> キーを押下すると、新しいターミナルが起動します。しかし、新しく起動したターミナルのカーソルは点滅しません。次節以降でこの問題点を解消していきます。</li></ul><p><img src=media/osbook_day24a.gif alt=osbook_day24a.gif></p><h4 id=hahahugoshortcode-s50-hbhb>osbook_day24b</h4><ul><li>アクティブなウィンドウのカーソルが点滅するように修正を行いました。</li></ul><p><img src=media/osbook_day24b.gif alt=osbook_day24b.gif></p><h4 id=hahahugoshortcode-s53-hbhb>osbook_day24c</h4><ul><li>以下の上側の gif からもわかるように複数のターミナルから複数のアプリケーションを起動できません。これは、仮想メモリ領域が競合しているからです。本節では、このバグを解消します。</li></ul><p><p><img src=media/osbook_day24c-invalid.gif alt=osbook_day24c-invalid.gif></p></p><ul><li>アプリケーション毎に仮想メモリ領域を切り替えるように修正を行いました。その結果、複数のターミナルから複数のアプリケーションを実行することができました。</li></ul><p><p><img src=media/osbook_day24c.gif alt=osbook_day24c.gif></p></p><h4 id=hahahugoshortcode-s59-hbhb>osbook_day24d</h4><ul><li>ウィンドウの重なりのバグを修正しました。</li></ul><p><p><img src=media/osbook_day24d-invalid.gif alt=osbook_day24d-invalid.gif></p></p><p><p><img src=media/osbook_day24d.gif alt=osbook_day24d.gif></p></p><h4 id=hahahugoshortcode-s65-hbhb>osbook_day24e</h4><ul><li>ターミナルを束縛せずにアプリケーションを起動させるように修正しました。</li></ul><p><img src=media/osbook_day24e.gif alt=osbook_day24e.gif></p><h3 id=2021-年-10-月-2-日>2021 年 10 月 2 日</h3><h4 id=hahahugoshortcode-s68-hbhb>osbook_day24f</h4><ul><li>本節では、意図的にアプリケーションがフリーズするコマンド <code>fault</code> を作成します。このコマンド
はアプリケーションがフリーズした時に上手にハンドリングを行う際に次節で活用します。</li></ul><p><img src=media/osbook_day24f.gif alt=osbook_day24f.gif></p><h4 id=hahahugoshortcode-s71-hbhb>osbook_day24g</h4><ul><li>アプリケーションが落ちた時の例外処理を実装しました。</li></ul><p><img src=media/osbook_day24g.gif alt=osbook_day24g.gif></p><h4 id=hahahugoshortcode-s74-hbhb>osbook_day25a</h4><ul><li><code>ls</code> コマンドを実行した際に、ディレクトリ配下のエントリも表示するように修正しました。</li></ul><p><img src=media/osbook_day25a.gif alt=osbook_day25a.gif></p><h4 id=hahahugoshortcode-s77-hbhb>osbook_day25b</h4><ul><li><p>ファイルの中身を読み出すアプリケーション <code>readfile コマンド</code> を実装しました！</p></li><li><p>途中でシステムコール内でバグがあったのですが、<code>Log 関数</code> を活用してバグのありそうな箇所を起点に二分探索風に調査を行いました。その結果、if 文の条件式の間違いに気づけました。バグの調査はヒヤヒヤするのですが、解決できると嬉しいです😁</p></li></ul><p><img src=media/osbook_day25b.gif alt=osbook_day25b.gif></p><h4 id=hahahugoshortcode-s80-hbhb>osbook_day25c</h4><ul><li><code>grep コマンド</code> を実装しました！</li></ul><p><img src=media/osbook_day25c.gif alt=osbook_day25c.gif></p><h3 id=2021-年-10-月-5-日>2021 年 10 月 5 日</h3><h4 id=hahahugoshortcode-s83-hbhb>osbook_day26a</h4><ul><li>エコーバックを実装しました！</li><li>3 回文字列を入力すると、exit する原因はわかりませんでした。</li></ul><p><img src=media/osbook_day26a.gif alt=osbook_day26a.gif></p><h4 id=hahahugoshortcode-s86-hbhb>osbook_day26b</h4><ul><li>例えば <code>grep コマンド</code> を実行すると、制御がターミナルに戻ってきません。そこで、この節では、<code>Ctrl + D</code> を押すことで、アプリケーションを停止する機能を実装しました！</li></ul><p><img src=media/osbook_day26b.gif alt=osbook_day26b.gif></p><h4 id=hahahugoshortcode-s89-hbhb>osbook_day26c</h4><ul><li>ファイルを新規で作成するためのロジックを実装しました！ここでお馴染みの <code>File Descriptor</code> を扱いました！</li></ul><p><img src=media/osbook_day26c.gif alt=osbook_day26c.gif></p><h4 id=hahahugoshortcode-s92-hbhb>osbook_day26d</h4><ul><li>新規で作成したファイルに書き込む機能を実装しました！つまり、<code>cp コマンド</code> を実行することができます。</li><li>この節で必要な機能を一通り実装し、HonOS を起動させると、以下の画像の上のようにアプリケーションから制御がターミナルに戻らず、フリーズしました。そこで、いつも通り二分探索 print デバッグを行うと、前節で実装した <code>ExtendCluster 関数</code> の中の for 文の終了条件が間違っており、無限ループから抜けられないような実装になっていました &mldr;</li><li>デバッグ中は、最悪このバグが解決できなかった時は、この本をやりきった研究室の同期に相談しようと思っていましたが、自力で解決できた時はめっちゃ嬉しかったです😁</li></ul><p><p><img src=media/osbook_day26d-invalid.gif alt=osbook_day26d-invalid.gif></p></p><p><p><img src=media/osbook_day26d-invalid-2.png alt=osbook_day26d-invalid-2.png></p></p><p><p><img src=media/osbook_day26d.gif alt=osbook_day26d.gif></p></p><h3 id=2021-年-10-月-5-日-1>2021 年 10 月 5 日</h3><ul><li>実装中🤞</li></ul><h2 id=参考>参考</h2><ul><li><a href=https://github.com/dilmnqvovpnmlib/honOS>honOS</a></li><li><a href=https://github.com/uchan-nos/mikanos>mikanos</a></li></ul></article><nav class="no-print post-nav"><a class=prev-post href=https://hakiwata.jp/post/20210831/><img class=icon-text src=https://hakiwata.jp/img/prev.svg>自作 OS 日記 (2)</a>
<a class=next-post href=https://hakiwata.jp/post/20210911/>自作 OS のリポジトリの README.md を自動更新する<img class=icon-text src=https://hakiwata.jp/img/next.svg></a></nav><section id=related><h4>See Also</h4><ul><li><a href=https://hakiwata.jp/post/20210831/>自作 OS 日記 (2)</a></li><li><a href=https://hakiwata.jp/post/20210830/>自作 OS 日記 (1)</a></li><li><a href=https://hakiwata.jp/post/20210618/>システムコール番号を使って write システムコールを呼び出す</a></li></ul></section><hr class=sep></main><footer class="container no-print"><div class=u-footer><a href=https://github.com/dilmnqvovpnmlib><img class=icon-social src=https://hakiwata.jp/img/github.svg alt=Github></a>
<a href=https://twitter.com/bilmnpvovqnmlid><img class=icon-social src=https://hakiwata.jp/img/twitter.svg alt=Twitter></a>
<a href=https://hakiwata.jp/index.xml target=_blank><img class=icon-social src=https://hakiwata.jp/img/feed.svg alt=Feed></a><p>&copy; 2021 haKiwata</p><a href=#brand><img class=icon-text src=https://hakiwata.jp/img/toup.svg alt="To Up">
<span>Back to Up</span></a></div></footer></body></html>