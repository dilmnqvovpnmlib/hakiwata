<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.83.1"><title>Vercel のドキュメントの修正を
Vercel Support に依頼してみた - haKiwata</title><meta name=description content="概要  こんにちは :) 最近、FasS 環境を使って Web API をデプロイしたい機会がありました。Vercel を使って API をデプロイすることにしたのですが、ドキュメントを読んで実装をしていると、サンプルコードの間違いに気づきました。そこで、その真偽を Velcel Support に問い合わせ、修正案を提案するという経験を初めてしました。今回はそこに至るまでの背景や Velcel Support とのやり取りにおいて勉強になったことなどについての記録を残したいと思います。  背景   そもそも、リクエストが飛んでくると簡単なスクリプトを実行する Web API をインターネット上に実装したいと考えていました。しかし、IaaS や PaaS で運用と管理するほどの API でもなくそれほどリクエストも飛ばないと判断したので、今回はイベント駆動形である FaaS を選択しました。
  次に、どのサービスの FaaS を使うかを検討しました。FaaS の代表格などに AWS Lambda / Google Cloud Functions / Vercel などが挙げられます。AWS Lambda と Google Cloud Functions は従量課金制度なので、Origin のフィルタリングなどにより、意図しないリクエストをどう弾くかの検討と実装をする必要があります。一方、Vercel は一つのドメインにぶら下げることができる API が無料枠では 12 個までしかデプロイできないといった制限がありますが、リクエスト回数に制限はありません。(そもそも、クレジットカードを登録していないので、莫大なリクエストが投げられたとしても自分に悪い影響はありません。) また、GitHub と連携させ、リモートに push するとアプリケーションのデプロイを即座に行うことができます。
  こうして、今回は Vercel を使ってWeb API をデプロイすることにしました。デプロイする言語は何でも良かったので、サポートしている言語の内、最近は全く書いていない TypeScript を選択しました。"><link rel="shortcut icon" href=https://hakiwata.jp/img/images/favicon.ico><link rel=stylesheet href=https://hakiwata.jp/css/ui.css><link rel=stylesheet href=https://hakiwata.jp/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Mono|Lato|Raleway"><meta property="og:title" content="Vercel のドキュメントの修正を
 Vercel Support に依頼してみた"><meta property="og:description" content="概要  こんにちは :) 最近、FasS 環境を使って Web API をデプロイしたい機会がありました。Vercel を使って API をデプロイすることにしたのですが、ドキュメントを読んで実装をしていると、サンプルコードの間違いに気づきました。そこで、その真偽を Velcel Support に問い合わせ、修正案を提案するという経験を初めてしました。今回はそこに至るまでの背景や Velcel Support とのやり取りにおいて勉強になったことなどについての記録を残したいと思います。  背景   そもそも、リクエストが飛んでくると簡単なスクリプトを実行する Web API をインターネット上に実装したいと考えていました。しかし、IaaS や PaaS で運用と管理するほどの API でもなくそれほどリクエストも飛ばないと判断したので、今回はイベント駆動形である FaaS を選択しました。
  次に、どのサービスの FaaS を使うかを検討しました。FaaS の代表格などに AWS Lambda / Google Cloud Functions / Vercel などが挙げられます。AWS Lambda と Google Cloud Functions は従量課金制度なので、Origin のフィルタリングなどにより、意図しないリクエストをどう弾くかの検討と実装をする必要があります。一方、Vercel は一つのドメインにぶら下げることができる API が無料枠では 12 個までしかデプロイできないといった制限がありますが、リクエスト回数に制限はありません。(そもそも、クレジットカードを登録していないので、莫大なリクエストが投げられたとしても自分に悪い影響はありません。) また、GitHub と連携させ、リモートに push するとアプリケーションのデプロイを即座に行うことができます。
  こうして、今回は Vercel を使ってWeb API をデプロイすることにしました。デプロイする言語は何でも良かったので、サポートしている言語の内、最近は全く書いていない TypeScript を選択しました。"><meta property="og:type" content="article"><meta property="og:url" content="https://hakiwata.jp/post/20220114/"><meta property="og:image" content="https://hakiwata.jp/"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-01-13T23:09:26+00:00"><meta property="article:modified_time" content="2022-01-13T23:09:26+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@bilmnpvovqnmlid"><meta name=twitter:creator content="@bilmnpvovqnmlid"><meta property="twitter:image" content="https://hakiwata.jp/img/images/20220114.png"><meta property="og:title" content="Vercel のドキュメントの修正を
 Vercel Support に依頼してみた"><meta property="og:url" content="https://hakiwata.jp/post/20220114/"><meta property="og:image" content="https://hakiwata.jp/img/images/20220114.png"><meta property="og:description" content><script async src="https://www.googletagmanager.com/gtag/js?id=G-YXCYPL25QW"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-YXCYPL25QW',{anonymize_ip:!1})}</script></head><body><header class="container no-print"><div class=u-header><nav class=bar><ul><li><a href=https://hakiwata.jp/><img class=icon-text src=https://hakiwata.jp/img/prev.svg></a></li><li><a href=https://hakiwata.jp/about>About</a></li><li><a href=https://hakiwata.jp/log>Log</a></li><li><a href=https://hakiwata.jp/post>Post</a></li><li><a href=https://hakiwata.jp/scraps>Scraps</a></li><li><a href=https://hakiwata.jp/tags>Tags</a></li></ul></nav></div></header><main class=container><article><header><hgroup id=brand><h1>Vercel のドキュメントの修正を
Vercel Support に依頼してみた</h1><h5><time datetime="2022-01-13 23:09:26 +0000 UTC">Jan 13, 2022</time>
<span class=no-print>-
<a href=https://hakiwata.jp/tags/vercel>Vercel</a>
<span></h5></hgroup><hr class=sep></header><h2 id=概要>概要</h2><ul><li>こんにちは :) 最近、FasS 環境を使って Web API をデプロイしたい機会がありました。<a href=https://vercel.com>Vercel</a> を使って API をデプロイすることにしたのですが、ドキュメントを読んで実装をしていると、サンプルコードの間違いに気づきました。そこで、その真偽を <a href=https://vercel.com/support>Velcel Support</a> に問い合わせ、修正案を提案するという経験を初めてしました。今回はそこに至るまでの背景や <a href=https://vercel.com/support>Velcel Support</a> とのやり取りにおいて勉強になったことなどについての記録を残したいと思います。</li></ul><h2 id=背景>背景</h2><ul><li><p>そもそも、リクエストが飛んでくると簡単なスクリプトを実行する Web API をインターネット上に実装したいと考えていました。しかし、IaaS や PaaS で運用と管理するほどの API でもなくそれほどリクエストも飛ばないと判断したので、今回はイベント駆動形である FaaS を選択しました。</p></li><li><p>次に、どのサービスの FaaS を使うかを検討しました。FaaS の代表格などに <a href=https://aws.amazon.com/jp/lambda/>AWS Lambda</a> / <a href=https://cloud.google.com/functions>Google Cloud Functions</a> / <a href=https://vercel.com>Vercel</a> などが挙げられます。<a href=https://aws.amazon.com/jp/lambda/>AWS Lambda</a> と <a href=https://cloud.google.com/functions>Google Cloud Functions</a> は従量課金制度なので、Origin のフィルタリングなどにより、意図しないリクエストをどう弾くかの検討と実装をする必要があります。一方、<a href=https://vercel.com>Vercel</a> は一つのドメインにぶら下げることができる API が無料枠では 12 個までしかデプロイできないといった制限がありますが、リクエスト回数に制限はありません。(そもそも、クレジットカードを登録していないので、莫大なリクエストが投げられたとしても自分に悪い影響はありません。) また、GitHub と連携させ、リモートに push するとアプリケーションのデプロイを即座に行うことができます。</p></li><li><p>こうして、今回は <a href=https://vercel.com>Vercel</a> を使ってWeb API をデプロイすることにしました。デプロイする言語は何でも良かったので、<a href=https://vercel.com/docs/concepts/functions/supported-languages>サポートしている言語</a>の内、最近は全く書いていない <code>TypeScript</code> を選択しました。</p></li><li><p>こうして、 <a href=https://vercel.com>Vercel</a> に API をデプロイする環境を整え、ドキュメントを読んで試行錯誤していると、<code>Node.js</code> 上で実行するためのサンプルコードの間違いに気づきました。</p></li></ul><h2 id=ドキュメントに間違いを見つけた箇所>ドキュメントに間違いを見つけた箇所</h2><ul><li><a href=https://vercel.com/docs/concepts/functions/supported-languages#node.js>Supported Languages for Serverless Functions</a> の Node.js のサンプルコードには、以下のように記述されていました。<code>req</code> と <code>res</code> が未定義なので、変数の扱いで間違っていそうです。</li></ul><div class=highlight><pre class=chroma><code class=language-js data-lang=js><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=nx>handler</span><span class=p>(</span><span class=nx>request</span><span class=p>,</span> <span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
  <span class=kr>const</span> <span class=p>{</span> <span class=nx>name</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>query</span><span class=p>;</span>
  <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>200</span><span class=p>).</span><span class=nx>send</span><span class=p>(</span><span class=sb>`Hello </span><span class=si>${</span><span class=nx>name</span><span class=si>}</span><span class=sb>!`</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div><ul><li>念の為、<a href=https://vercel.com/cli>Vercel CLI</a> を使ってエラーを確認しました。そして、エラーを踏まえて、例えば以下のように変数名を変更する必要があります。</li></ul><div class=highlight><pre class=chroma><code class=language-js data-lang=js><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=nx>handler</span><span class=p>(</span><span class=nx>request</span><span class=p>,</span> <span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
  <span class=kr>const</span> <span class=p>{</span> <span class=nx>name</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>request</span><span class=p>.</span><span class=nx>query</span><span class=p>;</span>
  <span class=nx>response</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>200</span><span class=p>).</span><span class=nx>send</span><span class=p>(</span><span class=sb>`Hello </span><span class=si>${</span><span class=nx>name</span><span class=si>}</span><span class=sb>!`</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div><ul><li>こうして開発環境と本番環境でサンプルコードの間違いと正しいプログラムの実装を確認しました。</li></ul><h2 id=vercel-support-とのやり取り>Vercel Support とのやり取り</h2><ul><li><p>以上を踏まえてドキュメントの修正の報告しようと考えました。しかし、 <a href=https://github.com/vercel/vercel/issues/new/choose>vercel/vercel</a> のリポジトリの README.md にはドキュメントの修正方法には言及されていませんでした。そのため、ひとまず <a href=https://github.com/vercel/vercel/issues/new/choose>vercel/vercel</a> のリポジトリの <a href=https://github.com/vercel/vercel/issues/new/choose>Issue</a> からの報告を検討しました。Issue を立てようとすると、<code>Bug Report</code> と <code>Feature Request</code> と <code>Ask a Question</code> を選択する必要があります。今回の場合は、とりあえず <code>Bug Report</code> を選択しました。そうすると、<a href=https://vercel.com/support/request>Vercel Support</a> のページに遷移したので、そこからドキュメントを修正する問合せなどを行いました。(よくよく考えると、<a href=https://aws.amazon.com/jp/premiumsupport/>AWS Support</a> と同様に、商用の FaaS のドキュメントに修正は中のエンジニアに依頼する他無いですよね &mldr;) 以下が実際に問合せたメールの内容です。</p></li><li><p>Kiwata からの問合せ</p></li></ul><p><img src=mail_2.png alt=mail_2.png></p><ul><li>Vercel Support からのメール</li></ul><p><img src=mail_1.png alt=mail_1.png></p><ul><li>Kiwata からのメール</li></ul><p><img src=mail_3.png alt=mail_3.png></p><ul><li>Vercel Support からのメール</li></ul><p><img src=mail_4.png alt=mail_4.png></p><ul><li>こうしてメールで Vercel Support の方とやり取りを行った結果、自分の報告が正しかったようで良かったです :)</li></ul><h2 id=最後に>最後に</h2><ul><li><p>ドキュメントが間違っているという認識があまり無かったので、こうした形ですがサービスの向上に貢献することができて良かったです。<a href=https://vercel.com/support/request>Vercel Support</a> からメールが返って来た時は意外と嬉しかったです。ゆくゆくは何かの大きい OSS にパッチを投げたいと考えているので、その一歩を踏み出せたのではないかと思いました。</p></li><li><p>また、全然関係ないですが、メールにあった <code>:)</code> この記号の意味がわかりませんでしたが、よくよく見るとニコチャンマークなのではないかと気づきました。これから自分も多用していきたいと思いました :)</p></li></ul><h2 id=参考>参考</h2><ul><li><a href=https://github.com/haytok/apis-for-nodejs-on-vercel/issues/1>Vercel サポートにドキュメントの修正の方法について問い合わせる</a></li></ul></article><nav class="no-print post-nav"><a class=prev-post href=https://hakiwata.jp/post/20211231/><img class=icon-text src=https://hakiwata.jp/img/prev.svg>2021 年を振り返って</a>
<a class=next-post href=https://hakiwata.jp/post/20220131/>修士課程で初めて
国内の研究会で発表をしてきた<img class=icon-text src=https://hakiwata.jp/img/next.svg></a></nav><hr class=sep></main><footer class="container no-print"><div class=u-footer><a href=https://github.com/haytok><img class=icon-social src=https://hakiwata.jp/img/github.svg alt=Github></a>
<a href=https://twitter.com/haytok6><img class=icon-social src=https://hakiwata.jp/img/twitter.svg alt=Twitter></a>
<a href=https://hakiwata.jp/index.xml target=_blank><img class=icon-social src=https://hakiwata.jp/img/feed.svg alt=Feed></a><p>&copy; 2021 haKiwata</p><a href=#brand><img class=icon-text src=https://hakiwata.jp/img/toup.svg alt="To Up">
<span>Back to Up</span></a></div></footer></body></html>