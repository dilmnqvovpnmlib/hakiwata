<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.83.1"><title>自作 OS のリポジトリの README.md を自動更新する - haKiwata</title><meta name=description content="概要  こんにちは！先月から 自作 OS に取り組んでいます。その進捗を綴った日記は 自作 OS 日記 にあり、日記にはその日までに出来上がった OS の挙動を記録した GIF を載せています。これまでは、この日記を更新すると、手動で 自作 OS のリポジトリの README.md に最新の OS GIF のリンクを貼り付けていました。ですが、最近、その作業がすごく面倒臭くなってきました。そこで、今回は 自作 OS 日記 を更新すると、 自作 OS のリポジトリの README.md も同時にアップデートされるように行った自動化の記録について書き残したいと思います。  方法  今回の自動化では、以下のようなパイプラインを構築しました。    一番のポイントは、リポジトリを跨いだ GitHub Actions のワークフローの連携です。これを実現するために、Repository Dispatch というアクションを使用しました。このアクションを用いて、自作 OS 日記 のコンテンツ配下のみが更新されると、workflow が走るような設計になっています。
  このアクションでは、client-payload というペイロードを活用すると、通知先にデータを送信することができます。いわゆる HTTP の POST メソッドのようなことができます。したがって、日記を更新した段階で最新の GIF のリンクを取得できれば、このパラメータを活用して 自作 OS リポジトリにその最新のファイル名を通知することができます。今回の自動化の流れでは、この最新の GIF のファイル名を Python と GitHub の API を用いて取得します。一番初めは、このやり方で実装を考えていたのですが、日記側のリポジトリと自作 OS 側のリポジトリの両方で Python のスクリプトを用意する必要がありました。これでは、双方のリポジトリに README."><link rel="shortcut icon" href=https://hakiwata.jp/img/images/favicon.ico><link rel=stylesheet href=https://hakiwata.jp/css/ui.css><link rel=stylesheet href=https://hakiwata.jp/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Mono|Lato|Raleway"><meta property="og:title" content="自作 OS のリポジトリの README.md を自動更新する"><meta property="og:description" content="概要  こんにちは！先月から 自作 OS に取り組んでいます。その進捗を綴った日記は 自作 OS 日記 にあり、日記にはその日までに出来上がった OS の挙動を記録した GIF を載せています。これまでは、この日記を更新すると、手動で 自作 OS のリポジトリの README.md に最新の OS GIF のリンクを貼り付けていました。ですが、最近、その作業がすごく面倒臭くなってきました。そこで、今回は 自作 OS 日記 を更新すると、 自作 OS のリポジトリの README.md も同時にアップデートされるように行った自動化の記録について書き残したいと思います。  方法  今回の自動化では、以下のようなパイプラインを構築しました。    一番のポイントは、リポジトリを跨いだ GitHub Actions のワークフローの連携です。これを実現するために、Repository Dispatch というアクションを使用しました。このアクションを用いて、自作 OS 日記 のコンテンツ配下のみが更新されると、workflow が走るような設計になっています。
  このアクションでは、client-payload というペイロードを活用すると、通知先にデータを送信することができます。いわゆる HTTP の POST メソッドのようなことができます。したがって、日記を更新した段階で最新の GIF のリンクを取得できれば、このパラメータを活用して 自作 OS リポジトリにその最新のファイル名を通知することができます。今回の自動化の流れでは、この最新の GIF のファイル名を Python と GitHub の API を用いて取得します。一番初めは、このやり方で実装を考えていたのですが、日記側のリポジトリと自作 OS 側のリポジトリの両方で Python のスクリプトを用意する必要がありました。これでは、双方のリポジトリに README."><meta property="og:type" content="article"><meta property="og:url" content="https://hakiwata.jp/post/20210911/"><meta property="og:image" content="https://hakiwata.jp/"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-09-10T15:50:53+00:00"><meta property="article:modified_time" content="2021-09-10T15:50:53+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@bilmnpvovqnmlid"><meta name=twitter:creator content="@bilmnpvovqnmlid"><meta property="og:title" content="自作 OS のリポジトリの README.md を自動更新する"><meta property="og:url" content="https://hakiwata.jp/post/20210911/"><meta property="og:image" content="https://hakiwata.jp/img/images/kiwata_partly.png"><meta property="og:description" content><script async src="https://www.googletagmanager.com/gtag/js?id=G-YXCYPL25QW"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-YXCYPL25QW',{anonymize_ip:!1})}</script></head><body><header class="container no-print"><div class=u-header><nav class=bar><ul><li><a href=https://hakiwata.jp/><img class=icon-text src=https://hakiwata.jp/img/prev.svg></a></li><li><a href=https://hakiwata.jp/about>About</a></li><li><a href=https://hakiwata.jp/post>Post</a></li><li><a href=https://hakiwata.jp/scraps>Scraps</a></li><li><a href=https://hakiwata.jp/tags>Tags</a></li></ul></nav></div></header><main class=container><article><header><hgroup id=brand><h1>自作 OS のリポジトリの README.md を自動更新する</h1><h5><time datetime="2021-09-10 15:50:53 +0000 UTC">Sep 10, 2021</time>
<span class=no-print>-
<a href=https://hakiwata.jp/tags/github>GitHub</a>
<a href=https://hakiwata.jp/tags/ci>CI</a>
<a href=https://hakiwata.jp/tags/cd>CD</a>
<a href=https://hakiwata.jp/tags/python>Python</a>
<span></h5></hgroup><hr class=sep></header><h2 id=概要>概要</h2><ul><li>こんにちは！先月から <a href=https://github.com/dilmnqvovpnmlib/honOS>自作 OS</a> に取り組んでいます。その進捗を綴った日記は <a href=https://hakiwata.jp/post/20210830/>自作 OS 日記</a> にあり、日記にはその日までに出来上がった OS の挙動を記録した GIF を載せています。これまでは、この日記を更新すると、手動で <a href=https://github.com/dilmnqvovpnmlib/honOS>自作 OS</a> のリポジトリの README.md に最新の OS GIF のリンクを貼り付けていました。ですが、最近、その作業がすごく面倒臭くなってきました。そこで、今回は <a href=https://hakiwata.jp/post/20210830/>自作 OS 日記</a> を更新すると、 <a href=https://github.com/dilmnqvovpnmlib/honOS>自作 OS</a> のリポジトリの README.md も同時にアップデートされるように行った自動化の記録について書き残したいと思います。</li></ul><h2 id=方法>方法</h2><ul><li>今回の自動化では、以下のようなパイプラインを構築しました。</li></ul><p><img src=architecture.png alt=architecture.png></p><ul><li><p>一番のポイントは、リポジトリを跨いだ GitHub Actions のワークフローの連携です。これを実現するために、<a href=https://github.com/marketplace/actions/repository-dispatch>Repository Dispatch</a> というアクションを使用しました。このアクションを用いて、<a href=https://hakiwata.jp/post/20210830/>自作 OS 日記</a> のコンテンツ配下のみが更新されると、workflow が走るような設計になっています。</p></li><li><p>このアクションでは、<code>client-payload</code> というペイロードを活用すると、通知先にデータを送信することができます。いわゆる HTTP の POST メソッドのようなことができます。したがって、日記を更新した段階で最新の GIF のリンクを取得できれば、このパラメータを活用して <a href=https://github.com/dilmnqvovpnmlib/honOS>自作 OS</a> リポジトリにその最新のファイル名を通知することができます。今回の自動化の流れでは、この最新の GIF のファイル名を Python と GitHub の API を用いて取得します。一番初めは、このやり方で実装を考えていたのですが、日記側のリポジトリと自作 OS 側のリポジトリの両方で Python のスクリプトを用意する必要がありました。これでは、双方のリポジトリに README.md を更新するために必要なスクリプトが存在してしまい、管理が面倒臭いです。</p></li><li><p>そこで、<a href=https://hakiwata.jp/post/20210830/>自作 OS 日記</a> のリポジトリでは日記の更新だけを検知するようにします。そして、<a href=https://github.com/dilmnqvovpnmlib/honOS>自作 OS</a> のリポジトリ側で <a href=https://hakiwata.jp/post/20210830/>自作 OS 日記</a> のリポジトリの変更を検知すると、事前に用意した <a href=https://github.com/dilmnqvovpnmlib/honOS/blob/main/scripts/main.py>Python のスクリプト</a> で最新の OS の GIF のリンクの取得と README.md の更新を行うように実装しました。</p></li></ul><h2 id=余談>余談</h2><ul><li>一番初めに考えていた <code>client-payload</code> を用いるやり方だと、Python のスクリプトを実行した結果を一旦 workflow の変数に保持する必要があります。その際に、<a href=(https://docs.github.com/en/actions/reference/workflow-commands-for-github-actions#set-an-output-parameter-set-output)>set-output コマンド</a> が役立ちそうです。このコマンドを活用すると、ステップ間で結果を共有することができます。今回は、<a href=https://hakiwata.jp/post/20210830/>自作 OS 日記</a> のリポジトリ側では変更を検知する通知を投げるだけなので、特に使用はしませんでしたが、今後活用できる機会が来るかも知れません。</li></ul><h2 id=最後に>最後に</h2><ul><li>こうしてリポジトリ間の GitHub Actions の連携を行い、面倒臭い README.md の更新の自動化を実現しました。GitHub Actions は奥が深いのでもっと色々な機能を使ってみたいと思いました🤞</li></ul><h2 id=参考>参考</h2><ul><li><p><a href=https://zenn.dev/mizchi/articles/3117b92a834531361fc8>Github Actions で他のリポジトリからの変更通知を受け取ってPRを作成する Workflow</a></p></li><li><p><a href=https://qiita.com/a_jike/items/9d454bf1efad0370ae03>GitHub Actionsを使ってリポジトリ間でファイルを機械的に同期する</a></p></li><li><p><a href=https://qiita.com/okitan/items/88994a36c996f2397a07>Github Actions を API から実行する</a></p></li><li><p><a href=https://github.com/marketplace/actions/repository-dispatch>Repository Dispatch</a></p></li><li><p><a href=https://qiita.com/chanhama/items/415a0a26bbb186efc47a>GitHub Actionsのset-outputに複数行の標準出力を代入する場合は改行コードをエスケープしてあげる必要がある</a></p></li><li><p><a href=https://docs.github.com/en/actions/reference/workflow-commands-for-github-actions>Workflow commands for GitHub Actions</a></p></li></ul></article><nav class="no-print post-nav"><a class=prev-post href=https://hakiwata.jp/post/20210901/><img class=icon-text src=https://hakiwata.jp/img/prev.svg>自作 OS 日記 (3)</a>
<a class=next-post href=https://hakiwata.jp/post/20211018/>ゼロからのOS自作入門を読んで OS を実装してみた<img class=icon-text src=https://hakiwata.jp/img/next.svg></a></nav><hr class=sep></main><footer class="container no-print"><div class=u-footer><a href=https://github.com/dilmnqvovpnmlib><img class=icon-social src=https://hakiwata.jp/img/github.svg alt=Github></a>
<a href=https://twitter.com/bilmnpvovqnmlid><img class=icon-social src=https://hakiwata.jp/img/twitter.svg alt=Twitter></a>
<a href=https://hakiwata.jp/index.xml target=_blank><img class=icon-social src=https://hakiwata.jp/img/feed.svg alt=Feed></a><p>&copy; 2021 haKiwata</p><a href=#brand><img class=icon-text src=https://hakiwata.jp/img/toup.svg alt="To Up">
<span>Back to Up</span></a></div></footer></body></html>