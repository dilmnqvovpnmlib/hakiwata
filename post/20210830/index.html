<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.83.1"><title>自作 OS 日記 (1) - haKiwata</title><meta name=description content="概要  こんにちは！最近、研究室の隣の同期に影響されて自作 OS を始めました。そこで、今回は自作 OS が成長していく様子を日記としてこの記事に残したいと思います。このエントリでは 1 ~ 10 章までの記録を残したいと思います。  日記 2021 年 8 月 13 日 osbook_day01  自作 OS を始めました！名前は HonOS です！名前の由来は櫻坂46 の田村保乃ちゃんのあだ名の「ほのす」から付けました。   2021 年 8 月 28 日 osbook_day09b osbook_day09c osbook_day09d 2021 年 8 月 29 日 osbook_day09e 2021 年 8 月 29 日 osbook_day10a osbook_day10b-invalid  FrameBuffer::Copy の実装が間違っていたせいで表示がバグってしまいました。状況を切り分けつつバグを調査する過程が最高に楽しかったです。  osbook_day10b  ウィンドウを表示することができました！  osbook_day10c  Kernel の main 関数の for ループ回数を書き込んだウィンドウを表示することができました！  2021 年 8 月 30 日  しかし、この記事を見た同期に表示されている色の挙動がおかしいと指摘されました。そこで、osbook_day10c に checkout し、正常系の挙動を確認してみました。そうすると、確かに正常系と比較すると、挙動がおかしかったので、バグを調査し修正しました。原因は constexpr PixelColor ToColor(uint32_t c); の色のビットシフトが逆になっていたことでした。だいぶ画面がチカチカしていますが、そのリファクタリングは次節以降でできればと思っています！  2021 年 8 月 31 日 osbook_day10d osbook_day10e  この節では、バックバッファに描画を行った後に、バックバッファをフレームバッファに転送を行います。こうして転送を行うことで、マウスカーソルが表示されない期間を完全になくし、カウンタにマウスを重ねた時のチラツキをなくすことができます。  参考  ゼロからOS自作入門 10章 【OpenGLでゲームを作る】ダブルバッファリングとは ダブルバッファリング 【double buffering】  描画処理について  osbook_day10f  USB ドライバからデータを取り出すプログラムは、マウスのボタンが押されたかとマウスがどれだけ移動したかの変位を取得できる機能のものでした。しかし、なぜかドライバから Kernel にそれらのデータが渡されませんでした。make clean や rm kernel."><link rel="shortcut icon" href=https://hakiwata.jp/img/images/favicon.ico><link rel=stylesheet href=https://hakiwata.jp/css/ui.css><link rel=stylesheet href=https://hakiwata.jp/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Mono|Lato|Raleway"><meta property="og:title" content="自作 OS 日記 (1)"><meta property="og:description" content="概要  こんにちは！最近、研究室の隣の同期に影響されて自作 OS を始めました。そこで、今回は自作 OS が成長していく様子を日記としてこの記事に残したいと思います。このエントリでは 1 ~ 10 章までの記録を残したいと思います。  日記 2021 年 8 月 13 日 osbook_day01  自作 OS を始めました！名前は HonOS です！名前の由来は櫻坂46 の田村保乃ちゃんのあだ名の「ほのす」から付けました。   2021 年 8 月 28 日 osbook_day09b osbook_day09c osbook_day09d 2021 年 8 月 29 日 osbook_day09e 2021 年 8 月 29 日 osbook_day10a osbook_day10b-invalid  FrameBuffer::Copy の実装が間違っていたせいで表示がバグってしまいました。状況を切り分けつつバグを調査する過程が最高に楽しかったです。  osbook_day10b  ウィンドウを表示することができました！  osbook_day10c  Kernel の main 関数の for ループ回数を書き込んだウィンドウを表示することができました！  2021 年 8 月 30 日  しかし、この記事を見た同期に表示されている色の挙動がおかしいと指摘されました。そこで、osbook_day10c に checkout し、正常系の挙動を確認してみました。そうすると、確かに正常系と比較すると、挙動がおかしかったので、バグを調査し修正しました。原因は constexpr PixelColor ToColor(uint32_t c); の色のビットシフトが逆になっていたことでした。だいぶ画面がチカチカしていますが、そのリファクタリングは次節以降でできればと思っています！  2021 年 8 月 31 日 osbook_day10d osbook_day10e  この節では、バックバッファに描画を行った後に、バックバッファをフレームバッファに転送を行います。こうして転送を行うことで、マウスカーソルが表示されない期間を完全になくし、カウンタにマウスを重ねた時のチラツキをなくすことができます。  参考  ゼロからOS自作入門 10章 【OpenGLでゲームを作る】ダブルバッファリングとは ダブルバッファリング 【double buffering】  描画処理について  osbook_day10f  USB ドライバからデータを取り出すプログラムは、マウスのボタンが押されたかとマウスがどれだけ移動したかの変位を取得できる機能のものでした。しかし、なぜかドライバから Kernel にそれらのデータが渡されませんでした。make clean や rm kernel."><meta property="og:type" content="article"><meta property="og:url" content="https://hakiwata.jp/post/20210830/"><meta property="og:image" content="https://hakiwata.jp/"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-08-29T19:11:00+00:00"><meta property="article:modified_time" content="2021-08-29T19:11:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@bilmnpvovqnmlid"><meta name=twitter:creator content="@bilmnpvovqnmlid"><meta property="twitter:image" content="https://hakiwata.jp/img/images/20210830.png"><meta property="og:title" content="自作 OS 日記 (1)"><meta property="og:url" content="https://hakiwata.jp/post/20210830/"><meta property="og:image" content="https://hakiwata.jp/img/images/20210830.png"><meta property="og:description" content><script async src="https://www.googletagmanager.com/gtag/js?id=G-YXCYPL25QW"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-YXCYPL25QW',{anonymize_ip:!1})}</script></head><body><header class="container no-print"><div class=u-header><nav class=bar><ul><li><a href=https://hakiwata.jp/><img class=icon-text src=https://hakiwata.jp/img/prev.svg></a></li><li><a href=https://hakiwata.jp/about>About</a></li><li><a href=https://hakiwata.jp/log>Log</a></li><li><a href=https://hakiwata.jp/post>Post</a></li><li><a href=https://hakiwata.jp/scraps>Scraps</a></li><li><a href=https://hakiwata.jp/tags>Tags</a></li></ul></nav></div></header><main class=container><article><header><hgroup id=brand><h1>自作 OS 日記 (1)</h1><h5><time datetime="2021-08-29 19:11:00 +0000 UTC">Aug 29, 2021</time>
<span class=no-print>-
<a href=https://hakiwata.jp/tags/os>OS</a>
<a href=https://hakiwata.jp/tags/kernel>Kernel</a>
<a href=https://hakiwata.jp/tags/c>C</a>
<span></h5></hgroup><hr class=sep></header><h2 id=概要>概要</h2><ul><li>こんにちは！最近、研究室の隣の同期に影響されて自作 OS を始めました。そこで、今回は自作 OS が成長していく様子を日記としてこの記事に残したいと思います。このエントリでは 1 ~ 10 章までの記録を残したいと思います。</li></ul><h2 id=日記>日記</h2><h3 id=2021-年-8-月-13-日>2021 年 8 月 13 日</h3><h4 id=hahahugoshortcode-s2-hbhb>osbook_day01</h4><ul><li>自作 OS を始めました！名前は HonOS です！名前の由来は櫻坂46 の田村保乃ちゃんのあだ名の「ほのす」から付けました。</li></ul><p><img src=media/osbook_day01.png alt=osbook_day01.png></p><h3 id=2021-年-8-月-28-日>2021 年 8 月 28 日</h3><h4 id=osbook_day09b>osbook_day09b</h4><p><img src=media/osbook_day09b.gif alt=osbook_day09b.gif></p><h4 id=osbook_day09c>osbook_day09c</h4><p><img src=media/osbook_day09c.gif alt=osbook_day09c.gif></p><h4 id=osbook_day09d>osbook_day09d</h4><p><img src=media/osbook_day09d.gif alt=osbook_day09d.gif></p><h3 id=2021-年-8-月-29-日>2021 年 8 月 29 日</h3><h4 id=osbook_day09e>osbook_day09e</h4><p><img src=media/osbook_day09e.gif alt=osbook_day09e.gif></p><h3 id=2021-年-8-月-29-日-1>2021 年 8 月 29 日</h3><h4 id=osbook_day10a>osbook_day10a</h4><p><img src=media/osbook_day10a.gif alt=osbook_day10a.gif></p><h4 id=osbook_day10b-invalid>osbook_day10b-invalid</h4><ul><li><code>FrameBuffer::Copy</code> の実装が間違っていたせいで表示がバグってしまいました。状況を切り分けつつバグを調査する過程が最高に楽しかったです。</li></ul><p><img src=media/osbook_day10b-invalid.gif alt=osbook_day10b-invalid.gif></p><h4 id=osbook_day10b>osbook_day10b</h4><ul><li>ウィンドウを表示することができました！</li></ul><p><img src=media/osbook_day10b.gif alt=osbook_day10b.gif></p><h4 id=osbook_day10c>osbook_day10c</h4><ul><li>Kernel の main 関数の for ループ回数を書き込んだウィンドウを表示することができました！</li></ul><p><img src=media/osbook_day10c-invalid.gif alt=osbook_day10c-invalid.gif></p><h3 id=2021-年-8-月-30-日>2021 年 8 月 30 日</h3><ul><li>しかし、この記事を見た同期に表示されている色の挙動がおかしいと指摘されました。そこで、<a href=https://github.com/uchan-nos/mikanos/tree/osbook_day10c>osbook_day10c</a> に checkout し、正常系の挙動を確認してみました。そうすると、確かに正常系と比較すると、挙動がおかしかったので、バグを調査し修正しました。原因は <code>constexpr PixelColor ToColor(uint32_t c);</code> の色のビットシフトが逆になっていたことでした。だいぶ画面がチカチカしていますが、そのリファクタリングは次節以降でできればと思っています！</li></ul><p><img src=media/osbook_day10c.gif alt=osbook_day10c.gif></p><h3 id=2021-年-8-月-31-日>2021 年 8 月 31 日</h3><h4 id=osbook_day10d>osbook_day10d</h4><p><img src=media/osbook_day10d.gif alt=osbook_day10d.gif></p><h4 id=osbook_day10e>osbook_day10e</h4><ul><li>この節では、バックバッファに描画を行った後に、バックバッファをフレームバッファに転送を行います。こうして転送を行うことで、マウスカーソルが表示されない期間を完全になくし、カウンタにマウスを重ねた時のチラツキをなくすことができます。</li></ul><p><img src=media/osbook_day10e.gif alt=osbook_day10e.gif></p><h5 id=参考>参考</h5><ul><li><a href=https://zenn.dev/link/comments/85cef9483586e5>ゼロからOS自作入門 10章</a></li><li><a href=https://nn-hokuson.hatenablog.com/entry/2014/01/15/164232>【OpenGLでゲームを作る】ダブルバッファリングとは</a></li><li><a href=https://e-words.jp/w/%E3%83%80%E3%83%96%E3%83%AB%E3%83%90%E3%83%83%E3%83%95%E3%82%A1%E3%83%AA%E3%83%B3%E3%82%B0.html>ダブルバッファリング 【double buffering】</a></li><li><a href=http://codebock.web.fc2.com/sec02_03.html>描画処理について</a></li></ul><h4 id=osbook_day10f>osbook_day10f</h4><ul><li>USB ドライバからデータを取り出すプログラムは、マウスのボタンが押されたかとマウスがどれだけ移動したかの変位を取得できる機能のものでした。しかし、なぜかドライバから Kernel にそれらのデータが渡されませんでした。<code>make clean</code> や <code>rm kernel.elf</code> を実行し、クリアな状況にしても状況が改善されませんでした。そこで、<code>Makefile</code> を本家からコピーすると正常な動きをするようになりましたが、なぜデータが Kernel 側に受け渡されなかったかの原因が不明のまま解決してしまいました。</li></ul><p><img src=media/osbook_day10f.gif alt=osbook_day10f.gif></p><h4 id=osbook_day10g>osbook_day10g</h4><p><img src=media/osbook_day10g.gif alt=osbook_day10g.gif></p><h2 id=参考-1>参考</h2><ul><li><a href=https://github.com/dilmnqvovpnmlib/honOS>honOS</a></li><li><a href=https://github.com/uchan-nos/mikanos>mikanos</a></li></ul></article><nav class="no-print post-nav"><a class=prev-post href=https://hakiwata.jp/post/20210628/><img class=icon-text src=https://hakiwata.jp/img/prev.svg>自作ブログの開発環境を
Docker で移行した</a>
<a class=next-post href=https://hakiwata.jp/post/20210831/>自作 OS 日記 (2)<img class=icon-text src=https://hakiwata.jp/img/next.svg></a></nav><section id=related><h4>See Also</h4><ul><li><a href=https://hakiwata.jp/post/20210618/>システムコール番号を使って write システムコールを呼び出す</a></li></ul></section><hr class=sep></main><footer class="container no-print"><div class=u-footer><a href=https://github.com/dilmnqvovpnmlib><img class=icon-social src=https://hakiwata.jp/img/github.svg alt=Github></a>
<a href=https://twitter.com/bilmnpvovqnmlid><img class=icon-social src=https://hakiwata.jp/img/twitter.svg alt=Twitter></a>
<a href=https://hakiwata.jp/index.xml target=_blank><img class=icon-social src=https://hakiwata.jp/img/feed.svg alt=Feed></a><p>&copy; 2021 haKiwata</p><a href=#brand><img class=icon-text src=https://hakiwata.jp/img/toup.svg alt="To Up">
<span>Back to Up</span></a></div></footer></body></html>